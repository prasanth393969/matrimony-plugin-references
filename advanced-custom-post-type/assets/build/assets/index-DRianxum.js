import{j as e,u as t}from"./fields-wnm5Jtc6.js";import{a as y,R as V,h as ns}from"./vendor-D21mNUGX.js";import{P as m,u as L,cq as je,cr as ve,a as z,B as M,s as T,cs as Oe,I as D,w as Le,r as be,ct as is,cu as xe,cv as Z,F as ue,y as as,cw as os,cx as rs,D as he,M as ds,J,cy as Be,cz as Ye,bR as Fe,S as qe,X as Ve,bV as cs,Y as us,cA as hs,U as ps,cB as ms,W as gs,cC as xs,m as fs,c as js,ad as vs,cD as bs,L as Ns,i as Ss,cE as ys}from"./index-pmrLY__j.js";import{s as Ne,n as le,b as ee,u as $e,B as Cs,D as ws,f as Is,L as Ps}from"./Layout-CFk9FOHT.js";import{u as $,c as se,b as A,g as ks,a as Ts,F as _s}from"./index.esm-DCQn2FO4.js";import{S as ne}from"./index-TA6SeI1j.js";import{a as ie,u as Se,C as ye}from"./sortable.esm-C-GypyhB.js";import{d as H,w as Q}from"./bundle.esm.min-B-HQpnrw.js";import{I as We}from"./InputHidden-B-jHubUl.js";import{L as K}from"./Label-aklbfFQf.js";import{a as Ge}from"./validation-Dyv8Y-XS.js";import{I as X}from"./Input-Cutb8bBf.js";import{S as Es}from"./Select-DRmfXoMp.js";import{I as Ds}from"./IconPicker-BdCVEM6X.js";import{u as Ce}from"./index-DRV1MUeg.js";import{M as Ue}from"./MenuPosition-obyEI7-r.js";import{R as Rs,b as As,c as Ms}from"./quill-CBfB4btM.js";import{T as G}from"./index-DvlEPr8_.js";import{M as pe}from"./index-76LCHVw3.js";import{E as Fs}from"./index-DSnODHa-.js";import{P as qs}from"./index-D0W-z-hb.js";import"./isEqual-DOWcrqPL.js";import"./index-DUg31hI9.js";const He=({parentPageIndex:s,pages:i})=>{const o=document.globals;o.settings;const c=o.globals,v=L(),[a]=Ce(),{control:x}=$(),{move:b}=se({control:x,name:`pages.${s}.children`}),S=u=>{const{active:r,over:l}=u;if(r.id===l.id)return;const d=i.findIndex(w=>w.id===r.id),h=i.findIndex(w=>w.id===l.id),p=ie(i,d,h);b(d,h),v(je({parentPageIndex:s,sortedPages:p}))},j=u=>{i&&i.map(r=>{v(ve({element:r,selected:u}))})};return e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{className:`acpt-table ${c.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10px"},children:e.jsxs("label",{className:"checkbox",htmlFor:`select-children-pages-${s}`,style:{marginLeft:"26px"},children:[e.jsx("input",{id:`select-children-pages-${s}`,type:"checkbox",onChange:u=>{j(u.target.checked)}}),e.jsx("span",{})]})}),e.jsx("th",{style:{width:"10px"}}),e.jsx("th",{children:t("Page title")}),e.jsx("th",{children:t("Menu title")}),e.jsx("th",{children:t("Menu slug")}),e.jsx("th",{}),e.jsx("th",{children:t("Actions")})]})}),e.jsx("tbody",{ref:a,children:e.jsx(ne,{onDragEnd:S,items:i,children:i&&i.map((u,r)=>e.jsx(me,{index:r,parentPageIndex:s,page:u},u.id))})})]})})};He.propTypes={pages:m.array.isRequired,parentPageIndex:m.number};const Qe=({id:s,setValue:i,placeholder:o,validate:c,register:v,defaultValue:a,description:x,characterLimit:b=null,className:S=null})=>{y.useEffect(()=>{v(s,c)},[v]);const[j,u]=y.useState(a||null),r=d=>{u(d),i(s,d)},l=d=>{b&&j.length>b&&d.key!=="Backspace"&&d.preventDefault()};return e.jsxs(V.Fragment,{children:[e.jsx(Rs,{className:S,theme:"snow",value:j,onKeyDown:l,onChange:r,modules:As,formats:Ms,placeholder:o}),x&&e.jsx("div",{className:"form-description",children:x})]})};Qe.propTypes={id:m.string.isRequired,setValue:m.func.isRequired,placeholder:m.string,validate:m.func,register:m.func.isRequired,description:m.string,defaultValue:m.string,className:m.string,characterLimit:m.number};const we=({element:s})=>{const i=L(),{selectedElements:o}=z(v=>v.optionPagesState),c=()=>o.filter(a=>a.id===s.id).length>0;return e.jsx(G,{label:e.jsxs("label",{className:"checkbox",htmlFor:`select-${s.id}`,style:{top:"3px"},children:[e.jsx("input",{id:`select-${s.id}`,type:"checkbox",checked:c(),onChange:v=>{i(ve({element:s,selected:v.target.checked}))}}),e.jsx("span",{})]}),icon:!1,tip:t(c()?"Deselect this element":"Select this element")})};we.propTypes={element:m.object.isRequired};const ze=({page:s,index:i,parentPageIndex:o,parentSetActiveTab:c})=>{const v=L(),[a,x]=y.useState(!1),b=()=>s.parentId?`pages.${o}.children`:"pages",{control:S}=$(),{remove:j}=se({control:S,name:b()}),u=[e.jsx(M,{style:T.SUCCESS,onClick:r=>{r.preventDefault(),v(Oe({page:s})),x(!a),c&&c(0),j(i)},children:t("Yes")}),e.jsx(M,{style:T.DANGER,onClick:r=>{r.preventDefault(),x(!a)},children:t("No")})];return e.jsxs(V.Fragment,{children:[e.jsx(pe,{title:t("Confirm deleting page"),visible:a,buttons:u,children:t("Are you sure?")}),e.jsx("a",{href:"#",onClick:r=>{r.preventDefault(),x(!a)},children:e.jsx(D,{icon:"bx-trash",width:18,color:"#F94144"})})]})};ze.propTypes={index:m.number.isRequired,parentPageIndex:m.number,page:m.object.isRequired,parentSetActiveTab:m.func};const Ke=({page:s,index:i,parentPageIndex:o,parentSetActiveTab:c,parentId:v})=>{const[a,x]=y.useState(!1),[b,S]=y.useState(null),[j,u]=y.useState(null),{control:r}=$(),l=A({control:r,name:"pages"}),d=p=>{S(p)},h=()=>{Le("copyOptionPageAction",{targetPageId:b,pageId:s.id,deletePage:j}).then(p=>{p.success?(Ne("Page was successfully copied"),x(!a),be()):le.error(p.error)}).catch(p=>console.error(p))};return e.jsxs(V.Fragment,{children:[e.jsx(pe,{title:t("Copy this meta option page"),visible:a,buttons:[],children:e.jsxs("div",{className:"flex-column s-24",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label i-flex-center s-4",htmlFor:"page",children:t("Option page")}),e.jsx("div",{className:"acpt-select",children:e.jsxs("select",{id:"page",className:"form-control",onChange:p=>d(p.target.value),children:[e.jsx("option",{value:null,children:t("Select")}),l&&l.map(p=>e.jsx("option",{value:p.id,children:p.pageTitle}))]})})]}),b&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-100 i-flex-center s-4 mb-8",children:[e.jsx("input",{type:"checkbox",defaultValue:j,onClick:()=>u(!j),id:"deletePage"}),e.jsx("label",{htmlFor:"deletePage",children:t("Delete the meta option page after copying")})]}),e.jsx(M,{onClick:()=>h(),style:T.PRIMARY,children:t("Copy")})]})]})}),e.jsx("a",{href:"#",onClick:p=>{p.preventDefault(),x(!a)},children:e.jsx(D,{icon:"bx:copy",width:18})})]})};Ke.propTypes={parentId:m.string.isRequired,index:m.number.isRequired,parentPageIndex:m.number,page:m.object.isRequired,parentSetActiveTab:m.func};const Ie=({page:s,index:i,parentPageIndex:o,formId:c,bulkEdit:v=!1})=>{const{formState:{errors:a},control:x}=$(),b=A({control:x,name:c()}),S=L(),{closedElements:j}=z(h=>h.optionPagesState),u=()=>j.filter(p=>p===s.id).length===1,r=()=>!(typeof s.isSaved<"u"&&s.isSaved===!1),l=()=>{as(s.id),u()?S(os({id:s.id})):S(rs({id:s.id}))},d=()=>{const p={id:he(),pageTitle:"New option child page",menuTitle:"Menu child title",menuSlug:"menu_child_slug",icon:null,position:99,description:null,parentId:s.id,capability:"manage_options",children:[],isSaved:!1};S(Z({page:p}))};return e.jsxs("span",{className:"i-flex-center s-8",children:[r()&&e.jsxs(V.Fragment,{children:[e.jsx(G,{label:e.jsx("a",{href:"#",onClick:h=>{h.preventDefault();let p;s.parentId!==null?p=is(s.parentId,b):p=xe(b),S(Z({page:p})),ue(1).then(()=>{ee(p.id)})},children:e.jsx(D,{icon:"bx:duplicate",width:18})}),tip:t("Duplicate this option page"),icon:!1}),s.parentId&&e.jsx(G,{label:e.jsx(Ke,{parentId:s.parentId,index:i,parentPageIndex:o,page:s}),tip:t("Copy this option page"),icon:!1}),e.jsx(G,{label:e.jsx(ze,{index:i,parentPageIndex:o,page:s}),tip:t("Delete this option page"),icon:!1})]}),!s.parentId&&e.jsx(G,{label:e.jsx("a",{href:"#",onClick:h=>{h.preventDefault(),d()},children:e.jsx(D,{icon:"bx:plus-circle",width:18})}),tip:t("Add child page"),icon:!1}),!v&&e.jsx(G,{label:e.jsx("a",{href:"#",onClick:h=>{h.preventDefault(),l()},children:e.jsx(D,{icon:"bx:expand-alt",width:18})}),tip:t("Hide/show this page"),icon:!1})]})};Ie.propTypes={bulkEdit:m.bool,index:m.number.isRequired,parentPageIndex:m.number,page:m.object.isRequired,formId:m.func.isRequired};const Je=({page:s,index:i,parentPageIndex:o})=>{const{attributes:c,listeners:v,setNodeRef:a,isDragging:x,transform:b}=Se({id:s.id}),S={transform:ye.Translate.toString(b)},[j]=Ce(),{register:u,control:r,formState:{errors:l},setValue:d,resetField:h,clearErrors:p,setError:w}=$(),n=(g=null)=>{if(s.parentId){let Y=`pages.${o}.children.${i}`;return g&&(Y+=`.${g}`),Y}let P=`pages.${i}`;return g&&(P+=`.${g}`),P},F=A({control:r,name:n("menuTitle")}),k=A({control:r,name:"pages"}),O=L(),[R,B]=y.useState(!0),f=()=>{const P={id:he(),pageTitle:"New option child page",menuTitle:"Menu child title",menuSlug:"menu_child_slug",icon:null,position:99,description:null,parentId:s.id,capability:"manage_options",children:[],isSaved:!1};O(Z({page:P})),ue(1).then(()=>{ee(P.id)})},C=[{label:t("Delete others pages"),value:"delete_others_pages"},{label:t("Delete others posts"),value:"delete_others_posts"},{label:t("Delete pages"),value:"delete_pages"},{label:t("Delete posts"),value:"delete_posts"},{label:t("Delete private pages"),value:"delete_private_pages"},{label:t("Delete private posts"),value:"delete_private_posts"},{label:t("Delete published pages"),value:"delete_published_pages"},{label:t("Delete published posts"),value:"delete_published_posts"},{label:t("Edit others pages"),value:"edit_others_pages"},{label:t("Edit others posts"),value:"edit_others_posts"},{label:t("Edit pages"),value:"edit_pages"},{label:t("Edit posts"),value:"edit_posts"},{label:t("Edit private pages"),value:"edit_private_pages"},{label:t("Edit private posts"),value:"edit_private_posts"},{label:t("Edit published pages"),value:"edit_published_pages"},{label:t("Edit published posts"),value:"edit_published_posts"},{label:t("Manage categories"),value:"manage_categories"},{label:t("Manage links"),value:"manage_links"},{label:t("Moderate comments"),value:"moderate_comments"},{label:t("Manage options"),value:"manage_options"},{label:t("Publish pages"),value:"publish_pages"},{label:t("Publish posts"),value:"publish_posts"},{label:t("Read"),value:"read"},{label:t("Read private posts"),value:"read_private_posts"},{label:t("Read private pages"),value:"read_private_pages"},{label:t("Unfiltered html"),value:"unfiltered_html"},{label:t("Upload files"),value:"upload_files"}],I=()=>s.children.length>0,_=g=>{if(R){const P=H(Q(g));q(P)?w(n("menuSlug"),{message:t("Name is already taken")}):p(n("menuSlug"))}},q=g=>{let P=[];if(k&&k.map((Y,ae)=>{ae!==i&&P.push(Y.menuSlug),Y.children&&Y.children.length>0&&Y.children.map((oe,re)=>{re!==i&&P.push(oe.menuSlug)})}),P.includes(g))return t("Name is already taken")},U=()=>{const g=n("menuSlug"),P=ks(l,g);return P?e.jsx("span",{className:"invalid-feedback",children:t(P.message)}):F||s.menuTitle};return e.jsx("tr",{id:s.id,ref:a,style:S,className:`bg-white ${x?"b-rounded z-100 with-drop-shadow":""}`,children:e.jsx("td",{style:{background:ds()},className:"with-active-border",colSpan:7,children:e.jsxs("div",{children:[e.jsx(We,{id:n("id"),value:s.id,register:u}),e.jsx("div",{className:"mb-24",children:e.jsxs("div",{className:"flex-between s-8 for-xs",children:[e.jsxs("span",{className:"i-flex-center s-8",children:[s.parentId&&e.jsx(G,{label:e.jsx(D,{icon:"tabler:arrow-guide",color:"#02C39A",width:18}),tip:t("Child field"),icon:!1}),e.jsx("span",{className:"cursor-move top-2 handle",...c,...v,children:e.jsx(D,{icon:"bx:dots-vertical-rounded",color:J(),width:18})}),e.jsx(we,{element:s}),e.jsx("h3",{children:U()})]}),e.jsx(Ie,{index:i,page:s,formId:n,parentPageIndex:o})]})}),e.jsxs("div",{className:"flex-column s-24",children:[e.jsxs("div",{className:"container align-end",children:[e.jsxs("div",{className:"col-4",children:[e.jsxs("div",{className:"flex-between s-8",children:[e.jsx(K,{isRequired:!0,id:n("pageTitle"),label:t("Page title")}),e.jsx("a",{href:"#",onClick:g=>{g.preventDefault(),B(!R)},children:t(`${R?"Auto slug ON":"Auto slug OFF"}`)})]}),e.jsx(X,{id:n("pageTitle"),register:u,errors:l,placeholder:t("Page title"),defaultValue:s.pageTitle,validate:{required:t("This field is mandatory"),validate:{checkIfNameIsValid:_},maxLength:{value:255,message:"max length is 255"}},onChangeCapture:g=>{R&&(d(n("menuTitle"),g.target.value),d(n("menuSlug"),H(Q(g.target.value))))},onClick:g=>{(g.target.value==="New option page"||g.target.value==="New option child page")&&h(n("pageTitle"))}})]}),e.jsxs("div",{className:"col-4",children:[e.jsx(K,{isRequired:!0,id:n("menuTitle"),label:t("Menu title")}),e.jsx(X,{id:n("menuTitle"),register:u,errors:l,placeholder:t("Menu title"),defaultValue:s.menuTitle,validate:{required:t("This field is mandatory"),validate:{checkIfNameIsValid:_},maxLength:{value:255,message:"max length is 255"}},onChangeCapture:g=>{R&&(d(n("pageTitle"),g.target.value),d(n("menuSlug"),H(Q(g.target.value))))},onClick:g=>{(g.target.value==="Menu title"||g.target.value==="Menu child title")&&h(n("menuTitle"))}})]}),e.jsxs("div",{className:"col-4",children:[e.jsx(K,{isRequired:!0,id:n("menuSlug"),label:t("Menu slug")}),e.jsx(X,{id:n("menuSlug"),register:u,errors:l,placeholder:t("Menu slug"),defaultValue:s.menuSlug,validate:{required:t("This field is mandatory"),validate:{alphanumericallyValid:Ge,checkIfSlugIsValid:q},maxLength:{value:255,message:"max length is 255"}},onChangeCapture:g=>{d(n("menuSlug"),H(Q(g.target.value)))},onClick:g=>{(g.target.value==="menu_slug"||g.target.value==="menu_child_slug")&&h(n("menuSlug"))}})]})]}),e.jsxs("div",{className:"container align-end",children:[!s.parentId&&e.jsxs(V.Fragment,{children:[e.jsxs("div",{className:"col-4",children:[e.jsx(K,{isRequired:!0,id:n("icon"),label:t("Menu icon")}),e.jsx(Ds,{id:n("icon"),callback:g=>{d(n("icon"),g)},defaultValue:s.icon,register:u,errors:l,validate:{required:t("This field is mandatory")}})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("div",{className:"flex-between s-8",children:e.jsx(K,{isRequired:!0,id:n("position"),label:t("Menu position")})}),e.jsx(Ue,{id:n("position"),defaultValue:s.position?s.position:99,register:u,setValue:d})]})]}),e.jsxs("div",{className:s.parentId?"col-12":"col-4",children:[e.jsx(K,{isRequired:!0,id:n("capability"),label:t("Capability")}),e.jsx(Es,{id:n("capability"),defaultValue:s.capability,placeholder:t("Select capability"),errors:l,register:u,values:C,validate:{required:t("This field is mandatory")}})]})]}),e.jsxs("div",{children:[e.jsx(K,{isRequired:!1,id:n("description"),label:t("Page description (will be displayed after the title)")}),e.jsx(Qe,{id:n("description"),setValue:d,register:u,defaultValue:s.description,style:{marginBottom:"42px"},control:r,errors:l,placeholder:t("Page description (will be displayed after the title)")})]}),!s.parentId&&e.jsxs("div",{ref:j,className:"flex-column s-24",children:[s.children&&s.children.length>0?e.jsxs(V.Fragment,{children:[e.jsx("label",{className:"form-label",style:{marginBottom:"0"},children:t("Children page list")}),e.jsx(He,{parentPageIndex:i,pages:s.children})]}):e.jsxs("div",{className:"b-maxi bg-white b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:t('No children already created. Create the first one now by clicking the button "Add child page"!')}),e.jsx("div",{children:e.jsx(M,{type:"button",style:T.SECONDARY,onClick:g=>{g.preventDefault(),f()},children:t("Add child page")})})]}),I()&&e.jsx("div",{children:e.jsx(M,{testId:"add-child-page",style:T.SECONDARY,onClick:g=>{g.preventDefault(),f()},children:t("Add child page")})})]})]})]})})})};Je.propTypes={index:m.number.isRequired,parentPageIndex:m.number,page:m.object.isRequired};const fe=({page:s,index:i,parentPageIndex:o,bulkEdit:c=!1})=>{const{attributes:v,listeners:a,setNodeRef:x,isDragging:b,transform:S}=Se({id:s.id}),j={transform:ye.Translate.toString(S)},{register:u,control:r,formState:{errors:l},setValue:d,resetField:h,clearErrors:p,setError:w}=$(),n=(N=null)=>{if(s.parentId){let W=`pages.${o}.children.${i}`;return N&&(W+=`.${N}`),W}let E=`pages.${i}`;return N&&(E+=`.${N}`),E},F=A({control:r,name:"pages"}),k=A({control:r,name:n("icon")}),O=A({control:r,name:n("pageTitle")}),R=A({control:r,name:n("menuTitle")}),B=A({control:r,name:n("menuSlug")}),f=A({control:r,name:n("position")}),{move:C}=se({control:r,name:`pages.${i}.children`}),[I,_]=y.useState(!0),[q,U]=y.useState(!1),[g,P]=y.useState(!1),[Y,ae]=y.useState(!1),[oe,re]=y.useState(!1),[ke,Te]=y.useState(!1),_e=y.useRef(),Ee=y.useRef(),De=y.useRef(),Re=y.useRef();$e([Re],()=>{P(!1)}),$e([De,Ee,_e],()=>{U(!1),ae(!1),re(!1),Te(!1)});const Ae=N=>{if(I){const E=H(Q(N));Me(E)?w(n("menuSlug"),{message:t("Name is already taken")}):p(n("menuSlug"))}},Me=N=>{let E=[];if(F&&F.map((W,te)=>{te!==i&&E.push(W.menuSlug),W.children&&W.children.length>0&&W.children.map((de,ce)=>{ce!==i&&E.push(de.menuSlug)})}),E.includes(N))return t("Name is already taken")},ss=()=>s.parentId?{paddingLeft:`${24+(1-1)*12}px`,borderLeft:"5px solid #02C39A"}:{},ts=N=>{if(!s.parentId){const{active:E,over:W}=N;if(E.id===W.id)return;const te=s.children,de=te.findIndex(ge=>ge.id===E.id),ce=te.findIndex(ge=>ge.id===W.id),ls=ie(te,de,ce);C(de,ce),dispatch(je({parentPageIndex:i,sortedPages:ls}))}};return e.jsxs(V.Fragment,{children:[e.jsx(We,{id:n("id"),value:s.id,register:u}),e.jsxs("tr",{id:s.id,ref:x,style:j,className:`bg-white ${b?"b-rounded z-100 with-drop-shadow":""}`,children:[e.jsx("td",{style:ss(),children:e.jsxs("span",{className:"i-flex-center s-8",children:[s.parentId&&e.jsx(G,{label:e.jsx(D,{icon:"tabler:arrow-guide",color:"#02C39A",width:18}),tip:t("Child field"),icon:!1}),e.jsx("span",{className:"cursor-move top-2 handle",...v,...a,children:e.jsx(D,{icon:"bx:dots-vertical-rounded",color:J(),width:18})}),e.jsx(we,{element:s})]})}),e.jsx("td",{children:s.icon&&e.jsx(Fs,{value:k||s.icon})}),e.jsx("td",{children:q||c?e.jsxs("div",{ref:_e,className:"w-100 i-flex-center s-8",children:[e.jsx(X,{id:n("pageTitle"),register:u,errors:l,autoFocus:Y,placeholder:t("Page title"),defaultValue:s.pageTitle,validate:{required:t("This field is mandatory"),validate:{checkIfNameIsValid:Ae},maxLength:{value:255,message:"max length is 255"}},onChangeCapture:N=>{I&&(d(n("menuTitle"),N.target.value),d(n("menuSlug"),H(Q(N.target.value))))},onClick:N=>{(N.target.value==="New option page"||N.target.value==="New option child page")&&h(n("pageTitle"))}}),e.jsx(G,{label:e.jsx("span",{className:`acpt-btn-switch ${I===!0?"active":""}`,onClick:N=>{N.preventDefault(),_(!I)},children:e.jsx(D,{icon:"bx-link",width:18})}),tip:t(`${I?"Auto slug ON":"Auto slug OFF"}`),icon:!1})]}):e.jsx("div",{className:"cursor-pointer",onClick:()=>{window.innerWidth>=960&&(U(!q),ae(!Y))},children:O||s.pageTitle})}),e.jsx("td",{className:"hidden-xs",children:q||c?e.jsx("div",{ref:Ee,className:"w-100 i-flex-center s-8",children:e.jsx(X,{id:n("menuTitle"),register:u,errors:l,autoFocus:oe,placeholder:t("Menu title"),defaultValue:s.menuTitle,validate:{required:t("This field is mandatory"),validate:{checkIfNameIsValid:Ae},maxLength:{value:255,message:"max length is 255"}},onChangeCapture:N=>{I&&(d(n("pageTitle"),N.target.value),d(n("menuSlug"),H(Q(N.target.value))))},onClick:N=>{(N.target.value==="Menu title"||N.target.value==="Menu child title")&&h(n("menuTitle"))}})}):e.jsx("div",{className:"cursor-pointer",onClick:()=>{window.innerWidth>=960&&(U(!q),re(!oe))},children:R||s.menuTitle})}),e.jsx("td",{className:"hidden-xs",children:q||c?e.jsx("div",{ref:De,className:"w-100 i-flex-center s-8",children:e.jsx(X,{id:n("menuSlug"),register:u,errors:l,autoFocus:ke,placeholder:t("Menu slug"),defaultValue:s.menuSlug,validate:{required:t("This field is mandatory"),validate:{alphanumericallyValid:Ge,checkIfSlugIsValid:Me},maxLength:{value:255,message:"max length is 255"}},onChangeCapture:N=>{d(n("menuSlug"),H(Q(N.target.value)))},onClick:N=>{(N.target.value==="menu_slug"||N.target.value==="menu_child_slug")&&h(n("menuSlug"))}})}):e.jsx("div",{className:"cursor-pointer",onClick:()=>{window.innerWidth>=960&&(U(!q),Te(!ke))},children:B||s.menuSlug})}),e.jsx("td",{children:g||c?e.jsx("div",{ref:Re,children:e.jsx(Ue,{id:n("position"),defaultValue:s.position?s.position:99,register:u,setValue:d})}):e.jsx("div",{className:"i-flex-center s-8 cursor-pointer",onClick:()=>{window.innerWidth>=960&&P(!g)},children:f||s.position})}),e.jsx("td",{children:e.jsx(Ie,{bulkEdit:c,index:i,page:s,formId:n,parentPageIndex:o})})]}),s.children&&s.children.length>0&&e.jsx(ne,{onDragEnd:ts,items:s.children,children:e.jsx(V.Fragment,{children:s.children&&s.children.length>0&&s.children.map((N,E)=>e.jsx(me,{bulkEdit:c,page:N,index:E,parentPageIndex:i}))})})]})};fe.propTypes={bulkEdit:m.bool,index:m.number.isRequired,parentPageIndex:m.number,page:m.object.isRequired};const me=({page:s,index:i,parentPageIndex:o,bulkEdit:c=!1})=>{const{closedElements:v}=z(x=>x.optionPagesState),a=()=>v.filter(b=>b===s.id).length===1;return c?e.jsx(fe,{bulkEdit:c,page:s,index:i,parentPageIndex:o}):a()?e.jsx(fe,{bulkEdit:c,page:s,index:i,parentPageIndex:o}):e.jsx(Je,{page:s,index:i,parentPageIndex:o})};me.propTypes={bulkEdit:m.bool,index:m.number.isRequired,parentPageIndex:m.number,page:m.object.isRequired};const Xe=({modalOpen:s,setModalOpen:i})=>{const{selectedElements:o}=z(r=>r.optionPagesState),[c,v]=y.useState(null),[a,x]=y.useState(null),{control:b}=$(),S=A({control:b,name:"pages"}),j=r=>{v(r)},u=()=>{let r=[];o&&o.map(l=>{r.push(l.id)}),Le("copyOptionPagesAction",{targetPageId:c,pageIds:r,deletePage:a}).then(l=>{l.success?(Ne("Page was successfully copied"),i(!s),be()):le.error(l.error),i(!s)}).catch(l=>{console.error(l),le.error(t("Unknown error, please retry later")),i(!s)})};return e.jsx(pe,{title:t("Copy this meta option page"),visible:s,buttons:[],children:e.jsxs("div",{className:"flex-column s-24",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label i-flex-center s-4",htmlFor:"page",children:t("Option page")}),e.jsx("div",{className:"acpt-select",children:e.jsxs("select",{id:"page",className:"form-control",onChange:r=>j(r.target.value),children:[e.jsx("option",{value:null,children:t("Select")}),S&&S.map(r=>e.jsx("option",{value:r.id,children:r.pageTitle}))]})})]}),c&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-100 i-flex-center s-4 mb-8",children:[e.jsx("input",{type:"checkbox",defaultValue:a,onClick:()=>x(!a),id:"deletePage"}),e.jsx("label",{htmlFor:"deletePage",children:t("Delete the meta option page after copying")})]}),e.jsx(M,{onClick:()=>u(),style:T.PRIMARY,children:t("Copy")})]})]})})};Xe.propTypes={modalOpen:m.bool.isRequired,setModalOpen:m.func.isRequired};const Vs=({})=>{const s=L(),{selectedElements:i}=z(l=>l.optionPagesState),{control:o,setValue:c,getValues:v}=$(),a=A({control:o,name:"pages"}),x=y.useRef(null),[b,S]=y.useState(null),[j,u]=y.useState(!1),r=()=>{i&&i.map(l=>{switch(b){case"copy":u(!j);break;case"duplicate":let d;if(l.parentId!==null){const h=a.findIndex(w=>w.id===l.parentId),p=a[h].children.findIndex(w=>w.id===l.id);d=xe(a[h].children[p]),a[h].children.push(d)}else{const h=a.findIndex(p=>p.id===l.id);d=xe(a[h]),a.push(d)}s(Z({page:d})),c("pages",a);break;case"delete":if(l.parentId!==null){const h=a.findIndex(w=>w.id===l.parentId),p=a[h].children.findIndex(w=>w.id===l.id);a[h].children.splice(p,1),c("pages",a)}else c("pages",a.filter(h=>h.id!==l.id));s(Oe({page:l}));break}}),(b==="delete"||b==="duplicate")&&s(Be()),x.current.value=""};return e.jsxs(V.Fragment,{children:[e.jsx(Xe,{modalOpen:j,setModalOpen:u}),i.length>0&&e.jsxs("div",{className:"flex-between",children:[e.jsxs("div",{children:[i.length," ",t("Selected items")]}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("select",{ref:x,className:"form-control sm",onChange:l=>{S(l.target.value!==""?l.target.value:null)},children:[e.jsx("option",{value:"",children:t("Select")}),e.jsx("option",{value:"copy",children:t("Copy")}),e.jsx("option",{value:"duplicate",children:t("Duplicate")}),e.jsx("option",{value:"delete",children:t("Delete")})]}),e.jsx(M,{style:T.WHITE,size:"sm",disabled:b===null,onClick:l=>{l.preventDefault(),r()},children:t("Execute")})]})]})]})},Pe=({index:s,parentPageIndex:i,page:o})=>{const c=L(),{attributes:v,listeners:a,setNodeRef:x,isDragging:b,transform:S}=Se({id:o.id}),j={transform:ye.Translate.toString(S)},u=()=>o.parentId?`pages.${i}.children.${s}.menuTitle`:`pages.${s}.menuTitle`,{control:r}=$(),l=A({control:r,name:u()}),h=document.globals.globals,[p,w]=y.useState(!1);if(o.parentId)return e.jsxs("div",{className:"tree-el level0 flex-between s-8",ref:x,style:j,children:[e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"cursor-move top-2 handle",...v,...a,children:e.jsx(D,{icon:"bx:dots-vertical-rounded",color:J(),width:18})}),e.jsx("span",{className:"text-ellipsis cursor-pointer",onClick:k=>{k.preventDefault(),ee(`${o.id}`)},children:l||o.menuTitle})]}),e.jsx(Cs,{style:T.SECONDARY,children:"C"})]},o.id);const{move:n}=se({control:r,name:`pages.${s}.children`}),F=k=>{const{active:O,over:R}=k;if(O.id===R.id)return;const B=o.children,f=B.findIndex(_=>_.id===O.id),C=B.findIndex(_=>_.id===R.id),I=ie(B,f,C);n(f,C),c(je({parentPageIndex:s,sortedPages:I}))};return e.jsxs("div",{ref:x,style:j,className:"b-rounded with-shadow bg-white p-24",children:[e.jsxs("h3",{className:`${!p&&o.children&&o.children.length>0?"mb-24":""} flex-between s-8`,children:[e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"cursor-move top-2 handle",...v,...a,children:e.jsx(D,{icon:"bx:dots-vertical-rounded",color:J(),width:18})}),e.jsx("span",{className:"text-ellipsis cursor-pointer",onClick:k=>{k.preventDefault(),ee(`${o.id}`)},children:l||o.menuTitle})]}),e.jsx("span",{className:"cursor-pointer top-2",onClick:()=>w(!p),children:e.jsx(D,{width:18,icon:p?"bx:chevron-up":"bx:chevron-down",color:J()})})]}),!p&&o.children&&o.children.length>0&&e.jsx("div",{className:`tree ${h.is_rtl===!0?"rtl":""}`,children:e.jsx(ne,{onDragEnd:F,items:o.children,children:o.children&&o.children.map((k,O)=>e.jsx(V.Fragment,{children:e.jsx(Pe,{page:k,parentPageIndex:s,index:O})}))})})]},o.id)};Pe.propTypes={index:m.number.isRequired,parentPageIndex:m.number,page:m.object.isRequired};const Ze=({pages:s})=>{const i=L(),{control:o}=$(),{move:c}=se({control:o,name:"pages"}),v=a=>{const{active:x,over:b}=a;if(x.id===b.id)return;const S=s.findIndex(r=>r.id===x.id),j=s.findIndex(r=>r.id===b.id),u=ie(s,S,j);c(S,j),i(Ye(u))};return s.length===0?null:e.jsx(V.Fragment,{children:e.jsx(ne,{onDragEnd:v,items:s,children:s&&s.map((a,x)=>e.jsx(Pe,{index:x,page:a}))})})};Ze.propTypes={pages:m.array.isRequired};const es=({pages:s})=>{const i=document.globals;i.settings;const o=i.globals,c=L(),{closedElements:v}=z(f=>f.optionPagesState),[a]=Ce(),{control:x}=$(),{move:b}=se({control:x,name:"pages"}),S=()=>{let f=[];return s.map(C=>{var I;Ve(C.id)&&f.push(C.id),(I=C.children)===null||I===void 0||I.map(_=>{Ve(_.id)&&f.push(_.id)})}),f.length===s.length},j="option_pages",[u,r]=y.useState(Fe(j)),[l,d]=y.useState(qe(j)),[h,p]=y.useState(S());y.useEffect(()=>{r(Fe(j)),d(qe(j)),p(S())},[s]);const w=f=>{const{active:C,over:I}=f;if(C.id===I.id)return;const _=s.findIndex(g=>g.id===C.id),q=s.findIndex(g=>g.id===I.id),U=ie(s,_,q);b(_,q),c(Ye(U))},n=f=>{s&&s.map(C=>{c(ve({element:C,selected:f}))})},F=()=>{const C={id:he(),pageTitle:"New option page",menuTitle:"Menu title",menuSlug:"menu_slug",icon:"admin-appearance",capability:"manage_options",position:99,description:null,parentId:null,children:[],isSaved:!1};c(Z({page:C})),ue(1).then(()=>{ee(C.id)})},k=f=>{cs(j,f),r(!u)},O=f=>{us(j,f),d(!l)},R=()=>{let f=[];s.map(C=>{f.push(C.id)}),v.length>0?(c(hs()),ps(f)):(c(ms()),gs(f)),p(!h)},B=()=>{let f=[];return f.push(e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{htmlFor:"toggle_visibility",className:"toggle",children:[e.jsx("input",{id:"toggle_visibility",type:"checkbox",checked:h,onChangeCapture:C=>{R()}}),e.jsx("span",{className:"slider round"})]})}),e.jsx("label",{className:"cursor-pointer",htmlFor:"toggle_visibility",children:t("Hide elements")})]})),f.push(e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{htmlFor:"toggle_bulk_edit",className:"toggle",children:[e.jsx("input",{id:"toggle_bulk_edit",type:"checkbox",checked:l,onChangeCapture:C=>{O(C.target.checked)}}),e.jsx("span",{className:"slider round"})]})}),e.jsx("label",{className:"cursor-pointer",htmlFor:"toggle_bulk_edit",children:t("Bulk edit")})]})),(s==null?void 0:s.length)>0&&f.push(e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{htmlFor:"toggle_navigation",className:"toggle",children:[e.jsx("input",{id:"toggle_navigation",type:"checkbox",checked:u,onChangeCapture:C=>{k(C.target.checked)}}),e.jsx("span",{className:"slider round"})]})}),e.jsx("label",{className:"cursor-pointer",htmlFor:"toggle_navigation",children:t(u?"Hide navigation":"Show navigation")})]})),f};return e.jsxs("div",{className:"flex-column s-24","data-cy":"list-view-pages",ref:a,children:[e.jsxs("div",{className:"flex-between s-8",children:[e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("h3",{children:t("Option pages")}),e.jsx("span",{className:"px-8 py-4 font-sm bg-light-gray text-normal b-rounded",children:(s==null?void 0:s.length)>0?s.length:0})]}),e.jsx(ws,{name:"meta-field-menu",buttonClass:T.WHITE,anchor:e.jsx(D,{icon:"bx:dots-vertical-rounded",color:J(),width:24}),links:B()})]}),e.jsx(Vs,{}),(s==null?void 0:s.length)>0?e.jsxs("div",{className:"container",children:[u&&e.jsx("div",{className:"col-3 flex-column s-24 hidden-xs sticky",style:{top:"130px"},children:e.jsx(Ze,{pages:s})}),e.jsx("div",{className:`flex-column s-24 ${u?"col-9":"col-12"}`,children:e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{className:`acpt-table ${o.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"select-pages",style:{marginLeft:"26px"},children:[e.jsx("input",{id:"select-pages",type:"checkbox",onChange:f=>{n(f.target.checked)}}),e.jsx("span",{})]})}),e.jsx("th",{style:{width:"10px"}}),e.jsx("th",{children:t("Page title")}),e.jsx("th",{className:"hidden-xs",children:t("Menu title")}),e.jsx("th",{className:"hidden-xs",children:t("Menu slug")}),e.jsx("th",{children:t("Menu position")}),e.jsx("th",{children:t("Actions")})]})}),e.jsx("tbody",{ref:a,children:e.jsx(ne,{onDragEnd:w,items:s,children:s&&s.map((f,C)=>e.jsx(me,{bulkEdit:l,index:C,page:f},f.id))})})]})})})]}):e.jsx("div",{className:"p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:t('No options already created. Create the first one now by clicking the button "Add option"!')}),e.jsx("div",{children:e.jsx(M,{testId:"add-page",style:T.SECONDARY,onClick:f=>{f.preventDefault(),F()},children:t("Add page")})})]})})]})};es.propTypes={pages:m.array.isRequired};const $s=()=>{const s=L(),{unregister:i}=$(),[o,c]=y.useState(!1),v=[e.jsx(M,{testId:"confirm-delete-all-pages",style:T.SUCCESS,onClick:a=>{a.preventDefault(),s(xs()),s(Be()),i("pages"),c(!o)},children:t("Yes")}),e.jsx(M,{style:T.DANGER,onClick:a=>{a.preventDefault(),c(!o)},children:t("No")})];return e.jsxs(V.Fragment,{children:[e.jsx(pe,{title:t("Confirm deleting all"),visible:o,buttons:v,children:t("Are you sure?")}),e.jsx(M,{testId:"delete-all-pages",style:T.DANGER,onClick:a=>{a.preventDefault(),c(!o)},children:t("Delete all")})]})},dt=({})=>{const s=L(),{loading:i}=z(l=>l.fetchOptionPages),{pages:o}=z(l=>l.optionPagesState),[c,v]=y.useState(!1),a=ns(),x=Ts({mode:"all"});y.useEffect(()=>{fs(t("Manage option pages")),js("#/option-pages"),s(vs({})).then(l=>{s(bs(l.payload.records)),Is(),l.payload.records&&l.payload.records.map((d,h)=>{x.setValue(`pages.${h}`,d)})}).catch(l=>{console.error(l),v(!0)})},[]);const b=()=>{const d={id:he(),pageTitle:"New option page",menuTitle:"Menu title",menuSlug:"menu_slug",icon:"admin-appearance",capability:"manage_options",position:99,description:null,parentId:null,children:[],isSaved:!1};s(Z({page:d})),ue(1).then(()=>{ee(d.id)})},S=()=>!(x.formState.errors&&x.formState.errors.pages),j=l=>{s(ys(l)).then(d=>{const h=d.payload;h.success?(Ne("Option pages successfully saved"),u(l),a("/option-pages"),be()):le.error(h.error)}).catch(d=>{le.error(d)})},u=l=>{let d=[];d.push({label:t("Select"),value:null}),l.pages&&l.pages.map(n=>{d.push({label:n.menuSlug,value:n.menuSlug}),n.children&&n.children.map(F=>{d.push({label:F.menuSlug,value:F.menuSlug})})});const h={optionPage:d},p={find:{...document.globals.globals.find,...h}},w={globals:{...document.globals.globals,...p}};document.globals={...document.globals,...w}},r=[e.jsx(M,{testId:"add-page",style:T.SECONDARY,onClick:l=>{l.preventDefault(),b()},children:t("Add page")}),e.jsx(M,{testId:"save-pages",disabled:!S(),style:T.PRIMARY,children:t("Save")}),e.jsx($s,{})];return i?e.jsx(Ns,{}):c?e.jsx(qs,{}):e.jsx(_s,{...x,children:e.jsx("form",{onSubmit:x.handleSubmit(j),children:e.jsx(Ps,{title:t("Manage option pages"),actions:r,crumbs:[{label:t("Option pages"),link:"/option-pages"},{label:t("Manage option pages")}],children:e.jsx(es,{pages:Ss(o)?[]:o})})})})};export{dt as default};
