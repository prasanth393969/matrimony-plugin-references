import{j as e,u as s}from"./fields-wnm5Jtc6.js";import{a as k,R as F,u as X}from"./vendor-D21mNUGX.js";import{P as w,u as N,B as j,s as v,$,I as L,a as E,J as Z,a0 as Y,a1 as ee,a2 as q,a3 as te,D as G,a4 as U,a5 as se,a6 as B,a7 as H,m as le,c as ae,L as ne,a8 as ie,a9 as oe}from"./index-pmrLY__j.js";import{u as R,c as V,b as M,a as re,F as ce}from"./index.esm-DCQn2FO4.js";import{n as A,a as de,L as ue}from"./Layout-CFk9FOHT.js";import{S as me}from"./index-TA6SeI1j.js";import{u as he,C as pe,a as xe}from"./sortable.esm-C-GypyhB.js";import{I as fe}from"./InputHidden-B-jHubUl.js";import{I as P}from"./Input-Cutb8bBf.js";import{T as O}from"./index-DvlEPr8_.js";import{M as _}from"./index-76LCHVw3.js";import{u as be}from"./index-DRV1MUeg.js";import{g as je}from"./files-BLOunQ8H.js";import"./index-DUg31hI9.js";const W=({id:t,index:d})=>{const n=N(),[o,i]=k.useState(!1),{control:a}=R(),{remove:r}=V({control:a,name:"items"}),f=[e.jsx(j,{style:v.SUCCESS,onClick:u=>{u.preventDefault(),n($({id:t})),r(d),i(!o)},children:s("Yes")}),e.jsx(j,{style:v.DANGER,onClick:u=>{u.preventDefault(),i(!o)},children:s("No")})];return e.jsxs("span",{children:[e.jsx(_,{title:s("Confirm deleting option"),visible:o,buttons:f,children:s("Are you sure?")}),e.jsx("a",{href:"#",onClick:u=>{u.preventDefault(),i(!o)},children:e.jsx(O,{icon:!1,tip:s("Delete"),label:e.jsx(L,{icon:"bx-trash",width:18,color:"#F94144"})})})]})};W.propTypes={id:w.string.isRequired,index:w.number.isRequired};const z=({item:t,index:d})=>{const n=N(),{selectedElements:o}=E(m=>m.datasetState),i=()=>o.filter(Q=>Q.id===t.id).length>0,a=m=>`items.${d}.${m}`,{register:r,formState:{errors:f},control:u,setValue:D,resetField:h}=R(),p=M({control:u,name:a("value")}),y=M({control:u,name:a("label")}),{attributes:b,listeners:c,setNodeRef:l,transform:x}=he({id:t.id}),g={transform:pe.Translate.toString(x)},S=()=>t.label==="label"&&t.value==="value"?!0:t.label===t.value,[C,T]=k.useState(S()),I=()=>t.isNew?t.value:p||(t.value?t.value:null),K=()=>t.isNew?t.label:y||(t.label?t.label:null);return e.jsxs(F.Fragment,{children:[e.jsx(fe,{id:a("id"),value:t.id,register:r}),e.jsxs("tr",{id:t.id,style:g,ref:l,children:[e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"cursor-move top-2 handle",...b,...c,children:e.jsx(L,{icon:"bx:dots-vertical-rounded",color:Z(),width:18})}),e.jsx(O,{label:e.jsxs("label",{className:"checkbox",htmlFor:`select-${t.id}`,style:{top:"3px"},children:[e.jsx("input",{id:`select-${t.id}`,type:"checkbox",checked:i(),onChange:m=>{n(Y({element:t,selected:m.target.checked}))}}),e.jsx("span",{})]}),icon:!1,tip:s(i()?"Deselect this element":"Select this element")})]})}),e.jsx("td",{children:e.jsx(P,{id:a("label"),register:r,errors:f,defaultValue:K(),onChangeCapture:m=>{C&&D(a("value"),m.target.value)},onClick:m=>{t.label&&m.target.value==="label"&&h(a("label"))},validate:{required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}),e.jsx("td",{children:e.jsx(P,{id:a("value"),register:r,errors:f,defaultValue:I(),onChangeCapture:m=>{C&&D(a("label"),m.target.value)},onClick:m=>{t.value&&m.target.value==="value"&&h(a("value"))},validate:{required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}),e.jsx("td",{children:e.jsx(O,{label:e.jsx("button",{type:"button",className:`acpt-btn-switch ${C?"active":""}`,onClick:m=>{m.preventDefault(),T(!C)},children:e.jsx(L,{icon:"bx:bx-link",width:"18px"})}),tip:s(C?"Label and value are linked":"Label and value are unlinked"),icon:!1})}),e.jsx("td",{children:e.jsx("div",{className:"i-flex-center s-8",children:e.jsx(W,{id:t.id,index:d})})})]})]})};z.propTypes={item:w.object.isRequired,index:w.number.isRequired};const ve=()=>{const t=N(),[d,n]=k.useState(!1),{unregister:o}=R(),i=[e.jsx(j,{style:v.SUCCESS,onClick:a=>{a.preventDefault(),t(ee()),o("items"),n(!d)},children:s("Yes")}),e.jsx(j,{style:v.DANGER,onClick:a=>{a.preventDefault(),n(!d)},children:s("No")})];return e.jsxs(F.Fragment,{children:[e.jsx(_,{title:s("Confirm deleting all"),visible:d,buttons:i,children:s("Are you sure?")}),e.jsx(j,{type:"button",style:v.DANGER,onClick:a=>{a.preventDefault(),n(!d)},children:s("Delete all")})]})},ye=()=>{const t=N(),{items:d,selectedElements:n}=E(c=>c.datasetState),{control:o,setValue:i,getValues:a}=R(),r=M({control:o,name:"items"}),{append:f,remove:u}=V({control:o,name:"items"}),D=k.useRef(null),[h,p]=k.useState(null),y=()=>{n.map(c=>{switch(h){case"duplicate":const l=G(),x={id:l,label:c.label,value:c.value,isDefault:!1,sort:r.length+1};t(U(x)),f({id:l,label:c.label,value:c.value});break;case"delete":const g=a("items").filter(S=>S.id!==c.id);i("items",g),t($({id:c.id}));break}}),t(q())},b=()=>(n==null?void 0:n.length)===(d==null?void 0:d.length);if((n==null?void 0:n.length)>0)return e.jsxs("div",{className:"flex-between",children:[e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("span",{children:[n==null?void 0:n.length," ",s("Selected items")]}),e.jsx("span",{children:e.jsx("a",{href:"#",onClick:c=>{c.preventDefault(),c.stopPropagation(),b()?t(q()):t(te())},children:s(b()?"deselect all":"select all")})})]}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("select",{ref:D,className:"form-control sm",onChange:c=>{p(c.target.value!==""?c.target.value:null)},children:[e.jsx("option",{value:"",children:s("Select")}),e.jsx("option",{value:"duplicate",children:s("Duplicate")}),e.jsx("option",{value:"delete",children:s("Delete")})]}),e.jsx(j,{style:v.WHITE,size:"sm",disabled:h===null,onClick:c=>{c.preventDefault(),y()},children:s("Execute")})]})]})},J=({id:t})=>{const d=N(),n=async o=>{const i=["json","csv","yaml"],a=o.target.files[0],r=je(a.name),f=a.type;if(!i.includes(r))return;let u=await a.text();const D=new File([u],a.name,{type:f});let h=new FormData;h.append("id",t),h.append("file",D),d(se(h)).then(p=>{const y=p.payload;y&&y.success===!0?(A.success(s("File was successfully imported")),d(B(t)).then(b=>{b.payload&&d(H(b.payload.items))}).catch(b=>{console.error(b)})):p.error&&A.error(e.jsx("span",{dangerouslySetInnerHTML:{__html:s("Error during import occurred")}}))}).catch(p=>{console.error(p),A(p)})};return e.jsxs(F.Fragment,{children:[e.jsx("input",{onChange:o=>n(o),style:{display:"none"},accept:"application/json, application/yaml,.csv,.yaml",name:"file",type:"file",id:"upload"}),e.jsx("label",{htmlFor:"upload",className:"acpt-btn acpt-btn acpt-btn-bordered",children:s("Import data")})]})};J.propTypes={id:w.string.isRequired};const Me=()=>{const t=document.globals;t.settings;const d=t.globals,{id:n}=X(),o=N(),{data:i,loading:a}=E(l=>l.fetchDataset),{items:r}=E(l=>l.datasetState),[f]=be(),u=re({mode:"all"});k.useEffect(()=>{de(),le(s(i.label??i.name)),ae("#/tools"),o(B(n)).then(l=>{l.payload&&(o(H(l.payload.items)),u.reset({items:l.payload.items}))}).catch(l=>{console.error(l)})},[n]);const{move:D}=V({control:u.control,name:"items"}),h=()=>{const l={id:G(),label:"label",value:"value",isDefault:!1,isNew:!0,sort:r.length+1};o(U(l))},p=l=>{const{active:x,over:g}=l;if(x.id===g.id)return;const S=r.findIndex(I=>I.id===x.id),C=r.findIndex(I=>I.id===g.id),T=xe(r,S,C);D(S,C),o(ie(T))},y=l=>{r&&r.map(x=>{o(Y({element:x,selected:l}))})},b=l=>{o(oe({id:i.id,name:i.name,label:i.label,items:l.items?l.items:[],emptyItems:!0})).then(x=>{const g=x.payload;g.success?A.success(s("Dataset successfully saved")):A.error(g.error)})},c=[e.jsx(J,{id:n}),e.jsx(j,{style:v.SECONDARY,type:"button",onClick:()=>{h()},children:s("Add element")}),e.jsx(j,{testId:"save-form",style:v.PRIMARY,type:"submit",children:s("Save")}),e.jsx(ve,{})];return a?e.jsx(ne,{}):e.jsx(ce,{...u,children:e.jsx("form",{id:i.id,onSubmit:u.handleSubmit(b),children:e.jsx(ue,{actions:c,title:s(i.label??i.name),crumbs:[{label:s("ACPT Tools"),link:"/tools"},{label:s("Dataset"),link:"/tools/dataset"},{label:s(i.label??i.name)}],children:r&&(r==null?void 0:r.length)>0?e.jsxs("div",{className:"flex-column s-24",ref:f,children:[e.jsx(ye,{}),e.jsx("div",{className:"bg-white b-rounded with-shadow",children:e.jsxs("div",{className:"responsive",children:[e.jsxs("table",{className:`acpt-table ${d.is_rtl?"rtl":""}`,children:[e.jsxs("thead",{children:[e.jsx("th",{style:{width:"10px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"select-all",style:{marginLeft:"26px"},children:[e.jsx("input",{id:"select-all",type:"checkbox",onChange:l=>{y(l.target.checked)}}),e.jsx("span",{})]})}),e.jsx("th",{children:s("Label")}),e.jsx("th",{children:s("Value")}),e.jsx("th",{style:{width:"10px"}}),e.jsx("th",{style:{width:"10px"}})]}),e.jsx("tbody",{ref:f,children:e.jsx(me,{onDragEnd:p,items:r,children:e.jsx(F.Fragment,{children:r.map((l,x)=>e.jsx(z,{index:x,item:l},l.id))})})})]}),e.jsx("div",{className:"p-24",children:e.jsx(j,{style:v.SECONDARY,type:"button",onClick:()=>{h()},children:s("Add element")})})]})})]}):e.jsx("div",{className:"p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:s('No elements saved, generate the first one clicking on "Add element" button')}),e.jsx("div",{children:e.jsx(j,{style:v.SECONDARY,type:"button",onClick:()=>{h()},children:s("Add element")})})]})})})})})};export{Me as default};
