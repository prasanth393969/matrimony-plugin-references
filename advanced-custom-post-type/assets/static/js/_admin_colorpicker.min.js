import{$$}from"./_admin_commons.min.js";import{theDarkerColorFromList}from"./_admin_helpers.min.js";var $=jQuery.noConflict();let initColorPicker=(t=null)=>{try{let e=t?"#"+t:".acpt-color-picker";$$(e).length&&"undefined"!=typeof wp&&$$(e).wpColorPicker({clear:function(t,e){t=t.target.previousElementSibling.querySelector("input");if(t.classList.contains("acpt-icon-picker-stroke")){var r=t.dataset.targetId,a=/stroke=\"(.*?)\"/gi;let e=$(`.acpt-icon-picker-preview[data-target-id=${r}]`).html();e=e.replaceAll(a,""),$(`.acpt-icon-picker-preview[data-target-id=${r}]`).html(e),$(`.acpt-icon-picker-value[data-target-id="${r}"]`).val(e)}if(t.classList.contains("acpt-icon-picker-fill")){a=t.dataset.targetId,r=/fill=\"(.*?)\"/gi;let e=$(`.acpt-icon-picker-preview[data-target-id=${a}]`).html();e=e.replaceAll(r,""),$(`.acpt-icon-picker-preview[data-target-id=${a}]`).html(e),$(`.acpt-icon-picker-value[data-target-id="${a}"]`).val(e)}},change:function(r,a){r=r.target,a=a.color.toString();if(r.dispatchEvent(new CustomEvent("acpt-icon-picker",{detail:{color:a}})),r.classList.contains("acpt-icon-picker-stroke")){var i=r.dataset.targetId,l=/stroke=\"(.*?)\"/gi;let e=$(`.acpt-icon-picker-preview[data-target-id=${i}]`).html();var o=[...e.matchAll(l)];if(0<o.length){let t=[];o.map(e=>{t.push(e[1])});o=theDarkerColorFromList(t);t.includes("currentColor")?e=e.replace(l,`fill="${a}"`):t.includes("none")||(l=new RegExp('stroke="'+o+'"',"gi"),e=e.replace(l,`stroke="${a}"`))}else e=e.replace("<svg ",`<svg stroke="${a}" `);$(`.acpt-icon-picker-preview[data-target-id=${i}]`).html(e),$(`.acpt-icon-picker-value[data-target-id="${i}"]`).val(e)}if(r.classList.contains("acpt-icon-picker-fill")){o=r.dataset.targetId,l=/fill=\"(.*?)\"/gi;let e=$(`.acpt-icon-picker-preview[data-target-id=${o}]`).html();i=[...e.matchAll(l)];if(0<i.length){let t=[];i.map(e=>{t.push(e[1])});r=theDarkerColorFromList(t);t.includes("currentColor")?e=e.replace(l,`fill="${a}"`):t.includes("none")||(i=new RegExp('fill="'+r+'"',"gi"),e=e.replace(i,`fill="${a}"`))}else e=e.replace("<svg ",`<svg fill="${a}" `);$(`.acpt-icon-picker-preview[data-target-id=${o}]`).html(e),$(`.acpt-icon-picker-value[data-target-id="${o}"]`).val(e)}}})}catch(e){console.error(e)}},handleColorFieldsEvents=()=>{$("body").on("click",".acpt-eye-dropper-button",function(e){e.preventDefault();let i=$(this),l=i.data("target-id");l&&(window.EyeDropper?(new EyeDropper).open().then(e=>{e=e.sRGBHex,r=!0;var r,t,a,e="#"+e.replace(/^rgba?\(|\s+|\)$/g,"").split(",").filter((e,t)=>!r||3!==t).map(e=>parseFloat(e)).map((e,t)=>3===t?Math.round(255*e):e).map(e=>e.toString(16)).map(e=>1===e.length?"0"+e:e).join("");t=e,(a=(new Option).style).color=t,""!==a.color?($("#"+l).val(e),i.prev(".wp-picker-container").find(".wp-color-result").css("background-color",e)):alert(e+" is not a valid CSS color")}).catch(e=>{console.error(e)}):alert("Your browser does not support the EyeDropper API"))})};export{initColorPicker,handleColorFieldsEvents};