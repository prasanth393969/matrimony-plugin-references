import{tinyMCEWordpressDefaultSettings}from"./_admin_commons.min.js";import{gutenbergIsEnabled}from"./_admin_helpers.min.js";var $=jQuery.noConflict();let __=wp.i18n.__,initTinyMCE=(c,u=8,m="full")=>{try{if("undefined"==typeof tinyMCE)console.error("tinyMCE is not defined. Include it here");else{let a=$("#"+c);var p=a.data("media"),y=$("#loading_"+c);let t=$("#buttons_"+c),r=$("#ch_counter_"+c),s=parseInt(r.data("max")),d=parseInt(r.data("min")),e=t.data("tabs")??"full",n=(tinyMCE.init(tinyMCEWordpressDefaultSettings(c,u,m)),tinyMCE.execCommand("mceToggleEditor",!1,c),tinyMCE.activeEditor),i=(n.on("change",function(t){var e=$(".save-variation-changes");e&&e.removeAttr("disabled")}),y.remove(),a.removeClass("hidden"),""),o=(1!==p&&(i+=`<div id="wp-${c}-media-buttons" class="wp-media-buttons">
                    <button type="button" id="insert-media-button" class="button insert-media add_media" data-editor="${c}">
                        <span class="wp-media-buttons-icon"></span> 
                        ${__("Add Media")}
                    </button>
                </div>`),i+='<div class="wp-editor-tabs">',"full"!==e&&"visual"!==e||(i+=`
                    <button type="button" id="${c}-tmce" aria-pressed="true" class="wp-switch-editor switch-tmce" data-wp-editor-id="${c}">
                        ${__("Visual")}
                    </button>
                `),"full"!==e&&"text"!==e||(i+=`
                    <button type="button" id="${c}-html" class="wp-switch-editor switch-html" data-wp-editor-id="${c}">
                        ${__("Text")}
                    </button>
                `),i+="</div>",t.html(i),()=>{if(s||d){let o=()=>{var t=n.contentDocument.body.innerText;return""===t.trim()?0:t.length},i=()=>{let t;gutenbergIsEnabled()?t=$(".editor-post-publish-button__button"):0<$("#publish").length?t=$("#publish"):0<$("#save-option-page").length?t=$("#save-option-page"):0<$("#submit").length?t=$("#submit"):0<$('input[type="submit"]').length&&(t=$('input[type="submit"]'));var e=o(),n=r.next(".acpt-error-list"),i=r.prev(".acpt-wp-editor-wrapper");e<d?(e="Min length "+d,a[0].setCustomValidity(e),a[0].reportValidity(),n.html(`<li>${e}</li>`),i.addClass("has-errors"),t&&t.attr("disabled","disabled")):(a[0].setCustomValidity(""),a[0].reportValidity(),n.html(""),i.removeClass("has-errors"),t&&t.removeAttr("disabled"))};n.on("load",function(t){r.html((()=>{var t=o();let e="";t<d||t>=s?e+="danger":t>=s-5?e+="warning":e="";t=s||"âˆž";return`<span class="count ${e}">${o()}</span>/<span class="max">${t}</span> `})()),i()}),n.on("keyup",function(t){var e=o(),n=r.find(".count");e<d||e>=s?(n.removeClass("warning"),n.addClass("danger")):e>=s-5?(n.removeClass("danger"),n.addClass("warning")):(n.removeClass("warning"),n.removeClass("danger")),n.text(e),i()}),n.on("keydown",function(t){return!!["Backspace","Delete","Shift","Control","ArrowLeft","ArrowRight"].includes(t.key)||!(o()>=s&&(t.preventDefault(),t.stopPropagation(),1))})}}),l=()=>{"text"===e&&n.on("load",function(t){window.switchEditors.go(c,"html")})};if(o(),l(),gutenbergIsEnabled()){let t=setTimeout(function(){a.prev(".mce-tinymce").find("iframe").contents().find("body").attr("contenteditable")?clearTimeout(t):(console.log("tinyMCE was not properly initialized, I am trying to restart it once again..."),tinyMCE.execCommand("mceRemoveEditor",!1,c),tinyMCE.init(tinyMCEWordpressDefaultSettings(c,u,m)),tinyMCE.execCommand("mceToggleEditor",!1,c),o(),l())},4e3)}}}catch(t){console.error(t),buttons.remove()}},destroyTinyMCE=t=>{try{"undefined"==typeof tinyMCE?console.error("tinymce is not defined. Include it here"):tinyMCE.execCommand("mceRemoveEditor",!1,t)}catch(t){console.error(t)}};function initEditorFields(){var t=$("textarea.acpt-wp-editor");t&&0<t.length&&t.each(function(t,e){initTinyMCE(e.id,e.getAttribute("rows"),e.dataset.toolbar)})}export{initTinyMCE,destroyTinyMCE,initEditorFields};