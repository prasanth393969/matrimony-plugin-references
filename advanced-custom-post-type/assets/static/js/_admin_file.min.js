import{useTranslation}from"./_admin_commons.min.js";var $=jQuery.noConflict();let handleFileFieldsEvents=()=>{$("body").on("click",".edit-file-label",function(e){var t=$(this),e=(e.preventDefault(),t.parent("div"));t.prev("input").removeClass("hidden"),t.addClass("hidden"),t.next(".save-file-label").removeClass("hidden"),e.find("a.acpt-text-truncate").addClass("hidden")}),$("body").on("click",".save-file-label",function(e){var t=$(this),e=(e.preventDefault(),t.parent("div")),a=e.find("input").val();t.prev("a").prev("input").addClass("hidden"),t.addClass("hidden"),t.prev(".edit-file-label").removeClass("hidden"),e.find("a.acpt-text-truncate").text(a),e.find("a.acpt-text-truncate").removeClass("hidden")}),$("body").on("click",".file-delete-btn",function(e){var t=$(this),e=(e.preventDefault(),t.data("target-id"),t.parent("div")),t=e.find("input"),e=e.prev(".file-preview");t.val(""),0<t.length&&t[1]&&t[1].dispatchEvent(new Event("change")),e.html("<span>No file selected</span>")}),$("body").on("click",".upload-file-btn",function(e){var t=$(this),a=t.data("id"),i=t.data("accepts");let d=t.data("max-size"),s=t.data("min-size"),o=t.data("target-id"),p=t.data("hide-label"),r=t.data("label-name"),u=t.prev("input"),v=u.prev("input"),c=$("#file-errors-"+a),h=t.parent("div");if(e.preventDefault(),wp&&wp.media){let l=wp.media({title:useTranslation("Upload a File"),library:{type:i.replace("document","application").split(",")},multiple:!1});l.on("open",function(e){var t,a;""!==v.val()&&(t=l.state().get("selection"),a=wp.media.attachment(v.val()),t.add(a))}),l.on("select",function(e){var t=l.state().get("selection").first(),a=t.attributes.filesizeInBytes;if(d&&1048576*d<a)return void c.html("Max size: "+d+"Mb");if(s&&a<1048576*s)return void c.html("Min size: "+s+"Mb");var a=t.toJSON().url,i=t.toJSON().id,t=t.toJSON().filename;v.val(i),u.val(a),0<u.length&&u[0].dispatchEvent(new Event("change"));let n=`<a title="${a}" class="acpt-text-truncate" target="_blank" href="${a}">${t}</a>`;0===p&&(n=(n=(n+=`<input id="${o}" name="${r}" type="text" class="hidden file-label-input" value="${t}" placeholder="${useTranslation("Enter download text link")}">`)+`<a href="#" data-target-id="${o}" class="edit-file-label" title="${useTranslation("Edit label")}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 24 24"><path fill="currentColor" d="M4 21a1 1 0 0 0 .24 0l4-1a1 1 0 0 0 .47-.26L21 7.41a2 2 0 0 0 0-2.82L19.42 3a2 2 0 0 0-2.83 0L4.3 15.29a1.06 1.06 0 0 0-.27.47l-1 4A1 1 0 0 0 3.76 21A1 1 0 0 0 4 21M18 4.41L19.59 6L18 7.59L16.42 6zM5.91 16.51L15 7.41L16.59 9l-9.1 9.1l-2.11.52z"/></svg>
                </a>`)+`<a href="#" data-target-id="${o}" class="save-file-label hidden" title="${useTranslation("Save label")}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 24 24"><path fill="currentColor" d="m10 15.586l-3.293-3.293l-1.414 1.414L10 18.414l9.707-9.707l-1.414-1.414z"/></svg>
                </a>`),h.prev(".file-preview").html(n)}),l.open();a=new Event("acpt_media_added");document.dispatchEvent(a)}else alert(useTranslation("The media gallery is not available. You must admin_enqueue this function: wp_enqueue_media()"))}),$("body").on("click",".upload-delete-btn",function(e){e.preventDefault(),e.stopPropagation();var e=$(this),t=e.data("target-id");let a=e.hasClass("delete-video-btn"),i=e.hasClass("delete-audio-btn");var n=()=>i?"No audio selected":a?"No video selected":"No image selected",t=($("#"+t).val(""),$("#"+t+"_copy").val(""),0<$("#"+t).length&&$("#"+t)[0].dispatchEvent(new Event("change")),0<$("#"+t+"_copy").length&&$("#"+t+"_copy")[0].dispatchEvent(new Event("change")),$("#"+t+"_attachment_id").val(""),$("#"+t+"[attachment_id]").val(""),e.prev(".button").prev(".inputs-wrapper").html(""),e.parent("div").prev(".image-preview").html(`<span class="placeholder">${useTranslation(n())}</span>`),e.parent("div").prev(".audio-preview").html(`<span class="placeholder">${useTranslation(n())}</span>`),e.parent("div").prev(".playlist-preview").html(`<span class="placeholder">${useTranslation(n())}</span>`),new Event("acpt_media_added"));document.dispatchEvent(t)}),$("body").on("click",".upload-audio-btn",function(e){var t=$(this);let s=t.prev("input"),o=s.prev("input"),p=t.parent("div");if(e.preventDefault(),e.stopPropagation(),wp&&wp.media){let d=wp.media({title:useTranslation("Upload an Audio file"),library:{type:["audio"]},multiple:!1});d.on("open",function(e){var t,a;""!==o.val()&&(t=d.state().get("selection"),a=wp.media.attachment(o.val()),t.add(a))}),d.on("select",function(e){var t=d.state().get("selection").first(),a=t.toJSON().url,i=t.toJSON().id,n=t.toJSON().title?t.toJSON().title:"Unknown title",l=t.toJSON().meta.album?t.toJSON().meta.album:"Unknown album",t=t.toJSON().meta.artist?t.toJSON().meta.artist:"Unknown artist";o.val(i),s.val(a),0<s.length&&s[0].dispatchEvent(new Event("change")),p.prev(".audio-preview").html(`
                <div class="audio">
                     <div class="acpt-audio-meta-wrapper">
                        <div class="acpt-audio-meta">
                            <h5 class="title">${n}</h5>
                            <div class="meta">
                                <span class="artist">${t}</span>
                                <span class="album">- ${l}</span>
                            </div>
                        </div>
                     </div>
                    <audio data-id="${i}" class="acpt-audio-player" controls src="${a}"></audio>
                </div>`)}),d.open();t=new Event("acpt_media_added");document.dispatchEvent(t)}else alert(useTranslation("The media gallery is not available. You must admin_enqueue this function: wp_enqueue_media()"))}),$("body").on("click",".upload-playlist-btn",function(e){let a=$(this),r=a.prev(".inputs-wrapper"),u=r.prev("input").prev("input"),v=a.data("parent-index"),c=r.data("target"),h=r.data("target-copy"),m=$("#"+c+"_copy");if(e.preventDefault(),e.stopPropagation(),wp&&wp.media){let n=wp.media({title:useTranslation("Select audio files"),library:{type:["audio"]},button:{text:useTranslation("Add audio files to the playlist")},multiple:"add"});n.on("open",function(e){if(""!==u.val()){let t=[];var a=n.state().get("selection");u.val().split(",").forEach(e=>{t.push(wp.media.attachment(e))}),a.add(t)}}),n.on("select",function(e){let l=[],t=[],d=[],s=[],o=[],i=(n.state().get("selection").map(function(e){e.toJSON(),e.attributes.url&&(l.push(e.attributes.id),t.push(e.attributes.url),d.push(e.attributes.title),s.push(e.attributes.meta.artist||"Unknown artist"),o.push(e.attributes.meta.album||"Unknown album"))}),[]),p=(r.html(""),t.map((e,t)=>{var a=h||c;r.append('<input name="'+a+'[]" type="hidden" data-index="'+t+'" value="'+e+'">'),i.push(e)}),"");0<i.length&&a.next("button").removeClass("hidden"),i.map((e,t)=>{var a=d[t],i=s[t],n=o[t];p+=`<div class="audio" data-index="${t}" draggable="true">
                    <div class="handle">
                        .<br/>.<br/>.
                    </div>
                    <div class="acpt-audio-meta-wrapper">
                        <div class="acpt-audio-meta">
                            <h5 class="title">${a}</h5>
                            <div class="meta">
                                <span class="artist">${i}</span>
                                <span class="album">- ${n}</span>
                            </div>
                        </div>
                        <audio data-id="${l[t]}" class="acpt-audio-player" controls src="${e}"></audio>
                    </div>
                    <a class="delete-playlist-audio-btn" data-index="${t}" data-parent-index="${v}" href="#" title="${useTranslation("Delete")}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
                            <path d="M5 20a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8h2V6h-4V4a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v2H3v2h2zM9 4h6v2H9zM8 8h9v12H7V8z"></path><path d="M9 10h2v8H9zm4 0h2v8h-2z"></path>
                        </svg>
                    </a>
                </div>`}),a.parent("div").prev(".playlist-preview").html(p),m.val(i.join(",")),m[0].dispatchEvent(new Event("change")),u.val(l.join(","))}),n.open();e=new Event("acpt_media_added");document.dispatchEvent(e)}else alert(useTranslation("The media gallery is not available. You must admin_enqueue this function: wp_enqueue_media()"))}),$("body").on("click",".delete-playlist-audio-btn",function(e){var t=$(this);e.preventDefault(),e.stopPropagation();let a=t.data("index");var e=t.data("parent-index"),t=t.parent(),i=t.parent(),n=i.data("target");let l;l=0<$("#"+n+"_attachment_id").length?$("#"+n+"_attachment_id"):$("#"+n+"\\[attachment_id\\]\\["+e+"\\]");var e=$("#"+n+"_copy"),n=e.next(".inputs-wrapper"),d=e.val().split(",");d.splice(a,1),e.val(d.join(",")),0<e.length&&e[0].dispatchEvent(new Event("change")),n.children("input").each(function(){$(this).data("index")===a&&$(this).remove()});let s=[];l.val().split(",").forEach((e,t)=>{t!==a&&s.push(e)}),l.val(s.join(",")),t.remove(),0===i.find(".audio").length&&i.html(`<span class="placeholder">${useTranslation("No file selected")}</span>`)}),$("body").on("click",".upload-image-slider-btn",function(e){var t=$(this),a=t.data("target-id");let u=t.data("index");var i=t.data("parent-index");let v=t.prev("input"),c=$("#"+a+"_copy"),h=$("#"+a+"_slider"),m=h.data("default-percent")??50,g=t.parent("div");h[0].style.setProperty("--position",m+"%");let f;if(f=0<$("#"+a+"_attachment_id").length?$("#"+a+"_attachment_id"):$("#"+a+"\\[attachment_id\\]\\["+i+"\\]"),e.preventDefault(),e.stopPropagation(),wp&&wp.media){let r=wp.media({title:useTranslation("Upload an Image"),library:{type:["image"]},multiple:!1});r.on("open",function(e){var t,a;""!==f.val()&&(t=r.state().get("selection"),a=wp.media.attachment(f.val()),t.add(a))}),r.on("select",function(e){var t,a,i=r.state().get("selection").first(),n=i.toJSON().url,l=i.toJSON().id,i=i.toJSON().name,d=(v.val(n),f.val()),s=c.val();let o,p;p=(""===d&&""===s?(a=[null,null],(t=[null,null])[u]=l,a[u]=n,o=t.join(","),a):(t=s.split(","),a=d.split(","),t[0]||(t[0]=null),t[1]||(t[1]=null),a[0]||(a[0]=null),a[1]||(a[1]=null),a[u]=l,t[u]=n,null!==t[0]&&null!==t[1]&&h.html(`
                    <div class="image-container">
                        <img
                            class="image-before slider-image"
                            src="${t[0]}"
                            alt=""
                        />
                       <img
                            class="image-after slider-image"
                             src="${t[1]}"
                            alt=""
                          />
                    </div>
                    <input type="range" min="0" max="100" value="${m}" class="slider">
                    <div class="slider-line" aria-hidden="true"></div>
                    <div class="slider-button" aria-hidden="true">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="30"
                            height="30"
                            fill="currentColor"
                            viewBox="0 0 256 256"
                          >
                            <rect width="256" height="256" fill="none"></rect>
                            <line
                              x1="128"
                              y1="40"
                              x2="128"
                              y2="216"
                              fill="none"
                              stroke="currentColor"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="16"
                            ></line>
                            <line
                              x1="96"
                              y1="128"
                              x2="16"
                              y2="128"
                              fill="none"
                              stroke="currentColor"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="16"
                            ></line>
                            <polyline
                              points="48 160 16 128 48 96"
                              fill="none"
                              stroke="currentColor"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="16"
                            ></polyline>
                            <line
                              x1="160"
                              y1="128"
                              x2="240"
                              y2="128"
                              fill="none"
                              stroke="currentColor"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="16"
                            ></line>
                            <polyline
                              points="208 96 240 128 208 160"
                              fill="none"
                              stroke="currentColor"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="16"
                            ></polyline>
                          </svg>
                        </div>
                    </div>
                `),o=a.join(","),t)).join(","),f.val(o),c.val(p),0<c.length&&c[0].dispatchEvent(new Event("change")),g.prev(".image-preview").html('<div class="image"><img data-id"'+l+'" src="'+n+'" alt="'+i+'"/></div>')}),r.open();t=new Event("acpt_media_added");document.dispatchEvent(t)}else alert(useTranslation("The media gallery is not available. You must admin_enqueue this function: wp_enqueue_media()"))}),$("body").on("click",".upload-delete-slider-btn",function(e){e.preventDefault(),e.stopPropagation();var e=$(this),t=e.data("target-id"),a=e.data("index"),i=e.data("parent-index"),n=e.prev("a").prev("input"),l=$("#"+t+"_copy"),d=$("#"+t+"_slider"),e=e.parent("div");let s;t=(s=0<$("#"+t+"_attachment_id").length?$("#"+t+"_attachment_id"):$("#"+t+"\\[attachment_id\\]\\["+i+"\\]")).val();let o,p;i=l.val().split(","),l=t.split(","),i[0]||(i[0]=null),i[1]||(i[1]=null),l[0]||(l[0]=null),l[1]||(l[1]=null),i[a]=l[a]=null,p=null===i[0]&&null===i[1]?o="":(o=l.join(","),i.join(",")),s.val(o),n.val(p),n.val(""),e.prev(".image-preview").html(`<div class="image"><span class="placeholder">${1===a?"Right":"Left"} image</span></div>`),d.html("<span class='placeholder'>Upload the left and the right images to see the slider</span>"),t=new Event("acpt_media_added");document.dispatchEvent(t)}),$("body").on("click",".upload-image-btn",function(e){var t=$(this);let l=t.prev("input"),d=l.prev("input"),s=t.parent("div");if(e.preventDefault(),e.stopPropagation(),wp&&wp.media){let n=wp.media({title:useTranslation("Upload an Image"),library:{type:["image"]},multiple:!1});n.on("open",function(e){var t,a;""!==d.val()&&(t=n.state().get("selection"),a=wp.media.attachment(d.val()),t.add(a))}),n.on("select",function(e){var t=n.state().get("selection").first(),a=t.toJSON().url,i=t.toJSON().id,t=t.toJSON().name;d.val(i),l.val(a),0<l.length&&l[0].dispatchEvent(new Event("change")),s.prev(".image-preview").html('<div class="image"><img data-id"'+i+'" src="'+a+'" alt="'+t+'"/></div>')}),n.open();t=new Event("acpt_media_added");document.dispatchEvent(t)}else alert(useTranslation("The media gallery is not available. You must admin_enqueue this function: wp_enqueue_media()"))}),$("body").on("click",".upload-video-btn",function(e){var t=$(this);let n=t.prev("input"),l=n.prev("input"),d=t.parent("div");if(e.preventDefault(),e.stopPropagation(),wp&&wp.media){let i=wp.media({title:useTranslation("Upload a Video"),library:{type:["video"]},multiple:!1});i.on("open",function(e){var t,a;""!==l.val()&&(t=i.state().get("selection"),a=wp.media.attachment(l.val()),t.add(a))}),i.on("select",function(e){var t=i.state().get("selection").first(),a=t.toJSON().url,t=t.toJSON().id;l.val(t),n.val(a),0<n.length&&n[0].dispatchEvent(new Event("change")),d.prev(".image-preview").html('<div class="image"><video controls><source src="'+a+'" type="video/mp4"></video></div>')}),i.open();t=new Event("acpt_media_added");document.dispatchEvent(t)}else alert(useTranslation("The media gallery is not available. You must admin_enqueue this function: wp_enqueue_media()"))}),$("body").on("click",".upload-gallery-btn",function(e){let s=$(this),o=s.data("parent-index"),p=s.prev(".inputs-wrapper"),r=p.prev("input").prev("input"),u=p.data("target"),v=p.data("target-copy"),c=$("#"+u+"_copy");if(e.preventDefault(),e.stopPropagation(),wp&&wp.media){let d=wp.media({title:useTranslation("Select images"),library:{type:["image"]},button:{text:useTranslation("Add images to the gallery")},multiple:"add"});d.on("open",function(e){if(""!==r.val()){let t=[];var a=d.state().get("selection");r.val().split(",").forEach(e=>{t.push(wp.media.attachment(e))}),a.add(t)}}),d.on("select",function(e){let a=[],t=[],i=[],n=(d.state().get("selection").map(function(e){e.toJSON(),e.attributes.url&&(a.push(e.attributes.id),t.push(e.attributes.url),i.push(e.attributes.name))}),[]),l=(p.html(""),t.map((e,t)=>{var a=v||u;p.append('<input name="'+a+'[]" type="hidden" data-index="'+t+'" value="'+e+'">'),n.push(e)}),"");0<t.length&&s.next("button").removeClass("hidden"),t.map((e,t)=>{l+=`
                    <div class="image" data-index="${t}">
                        <img data-id"${a[t]}" src="${e}" alt="${i[t]}"/>
                        <a class="delete-gallery-img-btn" data-index="${t}" data-parent-index="${o}" href="#" title="${useTranslation("Delete")}">x</a>
                    </div>
                `}),s.parent("div").prev(".image-preview").html(l),c.val(n.join(",")),0<c.length&&c[0].dispatchEvent(new Event("change")),r.val(a.join(","))}),d.open();e=new Event("acpt_media_added");document.dispatchEvent(e)}else alert(useTranslation("The media gallery is not available. You must admin_enqueue this function: wp_enqueue_media()"))}),$("body").on("click",".delete-gallery-img-btn",function(e){var t=$(this);e.preventDefault(),e.stopPropagation();let a=t.data("index");var e=t.data("parent-index"),t=t.parent(),i=t.parent(),n=i.data("target");let l;l=0<$("#"+n+"_attachment_id").length?$("#"+n+"_attachment_id"):$("#"+n+"\\[attachment_id\\]\\["+e+"\\]");var e=$("#"+n+"_copy"),n=e.next(".inputs-wrapper"),d=e.val().split(",");d.splice(a,1),e.val(d.join(",")),0<e.length&&e[0].dispatchEvent(new Event("change")),n.children("input").each(function(){$(this).data("index")===a&&$(this).remove()});let s=[];l.val().split(",").forEach((e,t)=>{t!==a&&s.push(e)}),l.val(s.join(",")),t.remove(),0===i.find(".image").length&&i.html(`<span class="placeholder">${useTranslation("No image selected")}</span>`)})};export{handleFileFieldsEvents};