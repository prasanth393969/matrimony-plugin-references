import{useTranslation}from"./_admin_commons.min.js";import{determineSVGAspectRatio}from"./_admin_helpers.min.js";var $=jQuery.noConflict();let ICONIFY_API_ROOT="https://api.iconify.design/",handleIconFieldsEvents=()=>{$("body").on("click",".acpt-icon-picker-button",function(e){e.preventDefault();e=$(this).data("target-id"),e=$("#"+(e+"_modal"));e.hasClass("hidden")?e.removeClass("hidden"):e.addClass("hidden")}),$("body").on("click",".acpt-icon-picker-selector > li",function(e){e.preventDefault();var e=$(this),a=e.parent("ul"),e=e.data("value");"upload"===e?(a.siblings(".acpt-icon-picker-upload").removeClass("hidden"),a.addClass("hidden")):"browse"===e&&(a.siblings(".acpt-icon-picker-browse").removeClass("hidden"),a.addClass("hidden")),a.prev(".acpt-icon-picker-back").removeClass("hidden")}),$("body").on("click",".acpt-icon-picker-back",function(e){e.preventDefault();var e=$(this),a=e.next("ul");e.addClass("hidden"),a.siblings(".acpt-icon-picker-upload").addClass("hidden"),a.siblings(".acpt-icon-picker-browse").addClass("hidden"),a.removeClass("hidden")}),$("body").on("change",".acpt-icon-picker-size > input",function(e){e.preventDefault();var e=$(this),a=e.data("target-id");let i=$(`.acpt-icon-picker-preview[data-target-id=${a}]`).html();var t=determineSVGAspectRatio(i),e=e.val(),t=Math.ceil(e*t),d=/width=\"(.*?)\"/,c=/height=\"(.*?)\"/,r=d.test(i),n=c.test(i);i=r&&n?(i=i.replace(d,`width="${e}px"`)).replace(c,`height="${t}px"`):(i=i.replace("<svg ",`<svg width="${e}px" `)).replace("<svg ",`<svg height="${t}px" `),$(`.acpt-icon-picker-preview[data-target-id=${a}]`).html(i),$(`.acpt-icon-picker-value[data-target-id="${a}"]`).val(i)}),$("body").on("click",".acpt-icon-picker-delete",function(e){e.preventDefault();var e=$(this),a=e.data("target-id");$(`.acpt-icon-picker-preview[data-target-id=${a}]`).html(""),$("#"+a).val(""),e.addClass("hidden"),$(`.acpt-icon-picker-preview-wrapper[data-target-id=${a}]`).addClass("hidden"),$(`.acpt-icon-picker-size[data-target-id=${a}]`).addClass("hidden"),$(`.acpt-icon-picker-stroke[data-target-id=${a}]`).addClass("hidden"),$(`.acpt-icon-picker-fill[data-target-id=${a}]`).addClass("hidden")}),$("body").on("change",".acpt-icon-picker-upload > input",function(e){e.preventDefault();e=$(this);let i=e.data("target-id");e=e.prop("files")[0];let t=new FileReader;t.readAsBinaryString(e),t.onloadend=function(){var e=t.result,e=(new DOMParser).parseFromString(e,"image/svg+xml").querySelector("svg").outerHTML,a=($(`.acpt-icon-picker-value[data-target-id="${i}"]`).val(e),$("#"+i+"_modal"));$('.acpt-icon-picker-preview[data-target-id="'+i+'"]').html(e),$(`.acpt-icon-picker-preview-wrapper[data-target-id=${i}]`).removeClass("hidden"),$(`.acpt-icon-picker-size[data-target-id=${i}]`).removeClass("hidden"),$(`.acpt-icon-picker-stroke[data-target-id=${i}]`).removeClass("hidden"),$(`.acpt-icon-picker-fill[data-target-id=${i}]`).removeClass("hidden"),$(`.acpt-icon-picker-size[data-target-id=${i}] > input`).val("24"),$(`input.acpt-icon-picker-stroke[data-target-id=${i}]`).val("#777777"),$(`input.acpt-icon-picker-fill[data-target-id=${i}]`).val("#777777"),a.hasClass("hidden")?a.removeClass("hidden"):a.addClass("hidden")}}),$("body").on("click",".acpt-icon-picker-provider",function(e){var a=$(this);a.hasClass("active")?a.removeClass("active"):a.addClass("active");let i=[];$(".acpt-icon-picker-provider.active").each(function(){var e=$(this).data("value");i.push(e)}),$(".acpt-icon-picker-icon").each(function(){var e=$(this).data("prefix"),a=$(this);!(0<i.length)||i.includes(e)?a.removeClass("hidden"):a.addClass("hidden")})}),$("body").on("input",".acpt-icon-picker-search",function(e){var a=$(this),e=e.target.value;let t=a.next(".acpt-icon-picker-results"),d=t.data("target-id");3<=e.length&&$.ajax({type:"GET",url:ICONIFY_API_ROOT+`search?query=${e}&limit=96`,success:function(i){if(t.html(""),i.collections){var e=Object.keys(i.collections).sort();let a='<div class="acpt-icon-picker-providers">';e.forEach(e=>{i.collections[e]&&i.collections[e]?.name&&(a+=`<div data-target-id="${d}" data-value="${e}" class="acpt-icon-picker-provider">${i.collections[e]?.name}</div>`)}),a+="</div>",t.append(a)}0<i.icons.length?i.icons.forEach(e=>{var a=e.split(":"),i=a[0],a=a[1],a=""+ICONIFY_API_ROOT+i+`/${a}.svg`;t.append(`<div data-target-id="${d}" data-value="${e}" data-prefix="${i}" class="acpt-icon-picker-icon" title="${e}"><img src="${a}" width="32" height="32"></div>`)}):t.append(`<div>${useTranslation("Sorry, no result match.")}</div>`),$(`.acpt-icon-picker-delete[data-target-id="${d}"]`).removeClass("hidden")},error:function(e){console.error(e),t.append(useTranslation("There was an error fetching icons, retry later."))}})}),$("body").on("click",".acpt-icon-picker-icon",function(e){e.preventDefault();var e=$(this),a=e.data("value");let i=e.data("target-id");e=a.split(":"),a=e[0],e=e[1],a=""+ICONIFY_API_ROOT+a+`/${e}.svg`;$.ajax({type:"GET",url:a,success:function(e){let a=e.children[0].outerHTML;e=determineSVGAspectRatio(a),e=Math.ceil(24*e),a=(a=a.replace(/width=\"(.*?)\"/,'width="24px"')).replace(/height=\"(.*?)\"/,`height="${e}px"`),$(`.acpt-icon-picker-value[data-target-id="${i}"]`).val(a),e=$("#"+i+"_modal");$('.acpt-icon-picker-preview[data-target-id="'+i+'"]').html(a),$(`.acpt-icon-picker-preview-wrapper[data-target-id=${i}]`).removeClass("hidden"),$(`.acpt-icon-picker-size[data-target-id=${i}]`).removeClass("hidden"),$(`.acpt-icon-picker-stroke[data-target-id=${i}]`).removeClass("hidden"),$(`.acpt-icon-picker-fill[data-target-id=${i}]`).removeClass("hidden"),$(`.acpt-icon-picker-size[data-target-id=${i}] > input`).val("24"),$(`input.acpt-icon-picker-stroke[data-target-id=${i}]`).val("#777777"),$(`input.acpt-icon-picker-fill[data-target-id=${i}]`).val("#777777"),e.hasClass("hidden")?e.removeClass("hidden"):e.addClass("hidden")},error:function(e){console.error(e),results.append(useTranslation("There was an error fetching icons, retry later."))}})}),$("body").on("click",".close-acpt-icon-picker",function(e){e.preventDefault();e=$(this).data("target-id"),e=$("#"+e);e.hasClass("hidden")?e.removeClass("hidden"):e.addClass("hidden")})};export{handleIconFieldsEvents};