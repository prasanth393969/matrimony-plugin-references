window.onload=function(){function f(e){return"string"==typeof e&&!isNaN(e)&&!isNaN(parseFloat(e))}function p(t,a=300){let n;return(...e)=>{clearTimeout(n),n=setTimeout(()=>{t.apply(this,e)},a)}}function r(e){let t=e.replaceAll("[","\\[");return t=t.replaceAll("]","\\]")}let u=(e,t)=>{var a=document.location.origin+document.globals.ajax_url,e={action:e,data:JSON.stringify(t)};return fetch(a,{method:"POST",body:new URLSearchParams(e).toString(),headers:{"Content-type":"application/x-www-form-urlencoded"}})},m=()=>{var t=document.getElementsByClassName("acpt-id-value");if(0<t.length)for(let e=0;e<t.length;e++){var l=t.item(e);if(l){let t=l;l=t.id,l=document.querySelector(".acpt-id-generate[data-target-id='"+l+"']");let a=l.dataset.idStrategy,n=l.dataset.index;l.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),u("generateIdAction",{strategy:a,index:n}).then(e=>e.text()).then(e=>{e=JSON.parse(e);e.id&&(t.value=e.id)}).catch(e=>{console.error(e)})})}}},g=(m(),o=>{if(["date","datetime","daterange","time"].includes(o)&&"function"==typeof moment){let e;switch(o){case"date":e="acpt-datepicker";break;case"datetime":e="acpt-datetimepicker";break;case"daterange":e="acpt-daterangepicker";break;case"time":e="acpt-timepicker"}var i,d,c=document.getElementsByClassName(e);if(0<c.length)for(let r=0;r<c.length;r++){let t=c.item(r),e=t.value,a=t.dataset.maxDate,n=t.dataset.minDate,l=t.dataset.format??"YYYY-MM-DD";t.nextElementSibling.addEventListener("click",function(e){e.preventDefault(),t.value=""});jQuery(t).daterangepicker((d=i=void 0,"daterange"===o?(i={drops:"up",startDate:e?e.split(" - ")[0]:moment(new Date).format(l),endDate:e?e.split(" - ")[1]:moment((i=7,(d=new Date).setDate(d.getDate()+i),d)).format(l),showDropdowns:!0,singleDatePicker:!1,locale:{format:l}},void 0!==a&&(i.maxDate=a),void 0!==n&&(i.minDate=n),i):"datetime"===o?{drops:"up",showDropdowns:!0,timePicker:!0,singleDatePicker:!0,locale:{format:l}}:"time"===o?{drops:"up",showDropdowns:!0,datePicker:!1,timePicker:!0,singleDatePicker:!0,locale:{format:l}}:{drops:"up",showDropdowns:!0,singleDatePicker:!0,locale:{format:l}})).on("show.daterangepicker",function(e,t){"time"===o&&t.container.find(".calendar-table").hide()})}}}),v=(g("daterange"),g("date"),g("datetime"),g("time"),()=>{var t=document.getElementsByClassName("acpt-country");if(0<t.length)for(let e=0;e<t.length;e++){var l=t.item(e);let a=jQuery(l),n=document.getElementById(l.id+"_country");a.countrySelect({defaultCountry:n.value,preferredCountries:[]}),a.on("change",e=>{var t=a.countrySelect("getSelectedCountryData");n.value=t.iso2})}}),h=(v(),()=>{var r=document.getElementsByClassName("acpt-phone");if(0<r.length)for(let t=0;t<r.length;t++){var o=r.item(t);let a=document.getElementById(o.id+"_country"),n=document.getElementById(o.id+"_dial"),e=document.getElementById(o.id+"_utils"),l=intlTelInput(o,{initialCountry:a.value,separateDialCode:!0,geoIpLookup:t=>{fetch("https://ipapi.co/json").then(e=>e.json()).then(e=>t(e.country_code)).catch(()=>t("us"))},loadUtils:()=>import(e.value)});o.addEventListener("countrychange",function(e){var t=l.getSelectedCountryData();t.iso2&&t.dialCode&&(a.value=t.iso2,n.value=t.dialCode)})}}),y=(h(),()=>{var t=document.getElementsByClassName("acpt-textarea");if(0<t.length)for(let e=0;e<t.length;e++){var a=t.item(e);let n=a.nextElementSibling;a.addEventListener("keyup",function(e){var e=e.target.value.length,t=n.querySelector(".count"),a=parseInt(n.dataset.max);e<parseInt(n.dataset.min)||a<=e?(t.classList.remove("warning"),t.classList.add("danger")):a-5<=e?(t.classList.remove("danger"),t.classList.add("warning")):(t.classList.remove("warning"),t.classList.remove("danger")),t.textContent=e})}}),E=(y(),()=>{var t=document.getElementsByClassName("acpt-delete-file"),a=document.getElementsByClassName("acpt-file");if(0<t.length)for(let e=0;e<t.length;e++){let a=t.item(e),n=a.dataset.target,l=a.dataset.value;a.addEventListener("click",function(e){e.preventDefault();var e=document.getElementById(n),t=e.value.split(",").filter(e=>e!==l);e.value=t.join(","),a.parentElement.remove()})}if(0<a.length)for(let e=0;e<a.length;e++){var n=a.item(e);let t=n.dataset.targetId;n.addEventListener("change",function(e){document.getElementById(t).value=""})}}),L=(E(),()=>{var a=document.getElementsByClassName("acpt-color-picker");if(0<a.length)for(let e=0;e<a.length;e++){var n=a.item(e),l=n.querySelector("input");let t=n.querySelector(".color_val");l&&l.addEventListener("change",function(e){t.innerHTML=e.target.value})}}),S=(L(),()=>{var t=document.getElementsByClassName("acpt-select2");if("function"==typeof TomSelect&&0<t.length)for(let e=0;e<t.length;e++){var a=t.item(e);a&&new TomSelect(a,{plugins:["remove_button","clear_button"],placeholder:"Select item(s)",persist:!1,create:!1,render:{item:function(e,t){return'<div class="item acpt-item">'+t(e.text)+"</div>"}}})}}),b=(S(),()=>{if("function"==typeof IconPicker){var n=document.getElementsByClassName("acpt-iconpicker");if(0<n.length)for(let e=0;e<n.length;e++){var l=n.item(e).dataset.target,r=new IconPicker(n.item(e),{theme:"bootstrap-5",iconSource:["Iconoir","FontAwesome Solid 6"],closeOnSelect:!0});let t=document.getElementById(l+"_target"),a=document.getElementById(l+"_svg");r.on("select",e=>{""!==t.innerHTML&&(t.innerHTML=""),t.className="acpt-selected-icon "+e.name,t.innerHTML=e.svg,a.value=e.svg})}}}),C=(b(),()=>{if("function"==typeof CodeMirror){var t=document.getElementsByClassName("acpt-codemirror");if(0<t.length)for(let e=0;e<t.length;e++){var a=t.item(e);a.nextElementSibling.classList.contains("CodeMirror")||CodeMirror.fromTextArea(a,{indentUnit:2,tabSize:2,mode:"htmlmixed",lineNumbers:!0})}}}),k=(C(),()=>{if("function"==typeof JsBarcode){var m=document.getElementsByClassName("acpt-barcode-wrapper");if(0<m.length)for(let a=0;a<m.length;a++){var g=m.item(a);let n=g.querySelector(".value"),l=g.querySelector(".format"),r=g.querySelector(".color"),o=g.querySelector(".bgColor");var v=g.querySelector(".clear-barcode");let e=g.querySelector(".acpt-barcode-svg"),i=g.querySelector(".acpt-barcode-errors"),d=e.id,c=document.getElementById("acpt-barcode-"+d),s=document.getElementById("barcode_value_"+d.replace("acpt-barcode-","")),u=()=>{e.innerHTML=`<svg class="acpt-barcode" id="${d}"></svg>`,n.value="",l.value="code128",r.value="#000000",o.value="#ffffff",s.value=""};let t=()=>{try{c.classList.remove("has-errors"),i.innerHTML="",JsBarcode("#"+d,n.value,{format:l.value||"code128",background:o.value||"#ffffff",lineColor:r.value||"#000000"});var e={svg:(t=c.outerHTML,a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},t.replace(/[&<>"']/g,function(e){return a[e]})),format:l.value||"code128",bgColor:o.value||"#ffffff",color:r.value||"#000000"};s.value=JSON.stringify(e)}catch(e){console.log(e),u(),t=`The value "${n.value}" is not valid for ${l.value} format`,c.classList.add("has-errors"),i.innerHTML=t}var t,a};v.addEventListener("click",function(e){e.preventDefault(),u()}),n.addEventListener("keyup",p(e=>{t()},1e3)),l.addEventListener("change",function(e){t()}),r.addEventListener("change",p(e=>{t()},1e3)),o.addEventListener("change",p(e=>{t()},1e3))}}}),w=(k(),()=>{if("function"==typeof QRCode){var u=document.getElementsByClassName("acpt-qr-code-wrapper");if(0<u.length)for(let s=0;s<u.length;s++){var m=u.item(s);let t=m.querySelector(".url"),a=m.querySelector(".resolution"),n=m.querySelector(".color-dark"),l=m.querySelector(".color-light");var g=m.querySelector(".clear-qr-code");let e=m.querySelector(".acpt-qr-code"),r=e.id,o=document.getElementById("qr_code_value_"+r.replace("acpt-qr-code-","")),i=()=>{e.innerHTML=""},d=()=>{i(),t.value="",a.value=100,n.value="#000000",l.value="#ffffff",o.value=""},c=()=>{var e;(e=>{try{return Boolean(new URL(e))}catch(e){return!1}})(t.value)?(i(),e=document.getElementById(r),new QRCode(e,{text:t.value,width:a.value,height:a.value,colorDark:n.value||"#000000",colorLight:l.value||"#ffffff",correctLevel:QRCode.CorrectLevel.H}),e={img:e.children[0].toDataURL("image/png"),resolution:a.value,colorDark:n.value||"#000000",colorLight:l.value||"#ffffff"},o&&(o.value=JSON.stringify(e))):d()};g.addEventListener("click",function(e){e.preventDefault(),d()}),t.addEventListener("keyup",p(e=>{c()},1e3)),a.addEventListener("change",function(e){c()}),n.addEventListener("change",p(e=>{c()},1e3)),l.addEventListener("change",p(e=>{c()},1e3))}}}),B=(w(),()=>{if("function"==typeof Quill){var t=document.getElementsByClassName("acpt-quill");if(0<t.length)for(let e=0;e<t.length;e++){let d=t.item(e),c=document.getElementById(d.id+"_hidden");var a=c.closest("form");let s=a.querySelector('[type="submit"]'),u=d.nextElementSibling,m=u.nextElementSibling,g=parseInt(u.dataset.max),v=parseInt(u.dataset.min);var n=parseInt(d.dataset.rows);parseInt(d.dataset.cols);if(!d.previousElementSibling.classList.contains("ql-toolbar")){let o=()=>{var e="Min length "+v;c.setCustomValidity(e),c.reportValidity(),d.classList.add("invalid"),m&&(m.innerHTML=`<li>${e}</li>`),s&&(s.disabled=!0)},i=new Quill("#"+r(d.id),{modules:{toolbar:[["bold","italic"],["link","blockquote","code-block","image"],[{list:"ordered"},{list:"bullet"}]]},theme:"snow"});var l=document.getElementById(""+r(d.id));l&&(l.querySelector(".ql-editor").style.height=25*n+"px"),s&&s.addEventListener("click",function(e){i.getLength()-1<v&&(e.preventDefault(),o())}),a.addEventListener("submit",function(e){i.getLength()-1<v&&(e.preventDefault(),o())}),i.on("text-change",function(e,t,a){i.getText();var n=i.getLength()-1,l=i.container.firstChild.innerHTML,r=u.querySelector(".count");c&&(f(v)&&(n<v?o():(c.setCustomValidity(""),c.reportValidity(),d.classList.remove("invalid"),m&&(m.innerHTML=""),s&&(s.disabled=!1))),f(g)&&n>=g&&i.history.undo(),r&&(n<v||n>=g?(r.classList.remove("warning"),r.classList.add("danger")):n>=g-5?(r.classList.remove("danger"),r.classList.add("warning")):(r.classList.remove("warning"),r.classList.remove("danger")),r.textContent=n),c.value=l)})}}}});B();(()=>{var t=document.getElementsByClassName("list-add-element");if(0<t.length)for(let e=0;e<t.length;e++){let l=t.item(e);l.addEventListener("click",function(e){e.preventDefault();var e=l.dataset.targetId,t=l.dataset.parentName,e=document.getElementById(e),a=e.children.length,n=document.createElement("div");n.classList.add("actp-form-inline"),n.id=t+"_"+a,n.insertAdjacentHTML("beforeend",`
                        <input
                                id='${t}_${a}' 
                                name='${t}[]' 
                                type='text'
                                class="actp-form-control"
                            />
                            <a 
                                class='list-remove-element' 
                                data-target-id='${t}_${a}' 
                                href='#'
                                title='Remove element'
                            >
                                <svg xmlns='http://www.w3.org/2000/svg' 
                                    width='24' 
                                    height='24' 
                                    viewBox='0 0 24 24' 
                                    style='fill: rgba(0, 0, 0, 1);transform: ;msFilter:;'
                                >
                                    <path d='M7 11h10v2H7z'></path>
                                    <path d='M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z'></path>
                                </svg>
                            </a>
                    `),e.append(n),r()})}let r=()=>{var a=document.getElementsByClassName("list-remove-element");if(0<a.length)for(let e=0;e<a.length;e++){let t=a.item(e);t.addEventListener("click",function(e){e.preventDefault();e=t.dataset.targetId,e=document.getElementById(e);e&&e.remove()})}};r()})();(()=>{var t=document.getElementsByClassName("add-grouped-element");if(0<t.length)for(let e=0;e<t.length;e++){let d=t.item(e);d.addEventListener("click",function(e){e.preventDefault();var e=d.dataset.groupId,t=d.dataset.layout,a=d.dataset.mediaType,n=d.dataset.parentIndex,l=d.dataset.parentName,r=d.dataset.formId;let o=document.querySelectorAll('[data-message-id="'+e+'"]'),i=document.getElementById(e);a={id:e,mediaType:a,layout:t,index:c(e,t),parentName:l,parentIndex:n,frontEnd:!0,formId:r};u("generateGroupedFieldsAction",a).then(e=>e.text()).then(e=>{e=JSON.parse(e);if(e.fields){i.insertAdjacentHTML("beforeend",e.fields),s(),E(),y(),h(),v(),b(),C(),B(),m(),k(),w(),L(),S(),g("daterange"),g("date"),g("datetime"),g("time");e=new CustomEvent("acpt_grouped_element_added",{detail:{list:i}});if(document.dispatchEvent(e),o)for(let e=0;e<o.length;e++)o.item(e).remove()}}).catch(e=>{console.error(e)})})}let c=(e,t)=>{e=document.getElementById(e);let a=0;return a=e?("table"===t?e.querySelectorAll("tr.sortable-li"):e.querySelectorAll("li")).length:a},s=()=>{var t=document.getElementsByClassName("remove-grouped-element");if(0<t.length)for(let e=0;e<t.length;e++){let s=t.item(e);s.addEventListener("click",function(e){e.preventDefault();var e=s.dataset.parentId,t=s.dataset.targetId,a=s.dataset.layout,n=s.dataset.element,t=(s.dataset.elements,document.getElementById(t)),l=t.parentNode;l.id,l.dataset.minBlocks;let r=l.dataset.maxBlocks,o=("table"===a?l.querySelectorAll("tr"):l.querySelectorAll("li")).length,i=document.querySelector(`.add-grouped-element[data-group-id="${e}"]`),d=()=>void 0===r||o<r;t.remove(),d()?i.removeAttribute("disabled"):i.setAttribute("disabled","disabled");let c;0===(c="table"===a?l.querySelectorAll("tr").length-1:l.querySelectorAll("li").length)&&(l.innerHTML=`<p data-message-id="${e}" class="update-nag notice notice-warning inline no-records">${`No fields saved, generate the first one clicking on "Add ${n}" button`}</p>`);t=new CustomEvent("acpt_grouped_element_removed",{detail:{list:l}});document.dispatchEvent(t)})}};s()})(),["acpt_grouped_element_removed","acpt_grouped_element_added"].map(o=>{document.addEventListener(o,e=>{var l=e.detail.list.querySelectorAll(".acpt-id-value");for(let n=0;n<l.length;n++){let t=l.item(n);var r=t.id;let e=n;r=document.querySelector(".acpt-id-generate[data-target-id='"+r+"']");let a=r.dataset.idStrategy;r.dataset.index;("acpt_grouped_element_added"===o&&n===l.length-1||"auto_inc"===a)&&u("generateIdAction",{strategy:a,index:e}).then(e=>e.text()).then(e=>{e=JSON.parse(e);e.id&&(t.value=e.id)}).catch(e=>{console.error(e)})}})})};